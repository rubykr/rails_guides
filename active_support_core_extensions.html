<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Ruby on Rails Guides: Active Support Core Extensions</title>

<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">
      <strong>More at <a href="http://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <a href="http://rubyonrails.org/">Overview</a> |
      <a href="http://rubyonrails.org/download">Download</a> |
      <a href="http://rubyonrails.org/deploy">Deploy</a> |
      <a href="http://rails.lighthouseapp.com/projects/8994-ruby-on-rails/overview">Code</a> |
      <a href="http://rubyonrails.org/screencasts">Screencasts</a> |
      <a href="http://rubyonrails.org/documentation">Documentation</a> |
      <a href="http://rubyonrails.org/ecosystem">Ecosystem</a> |
      <a href="http://rubyonrails.org/community">Community</a> |
      <a href="http://weblog.rubyonrails.org/">Blog</a>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Return to home page">Guides.rubyonrails.org</a></h1>
      <p class="hide"><a href="#mainCol">Skip navigation</a>.</p>
      <ul class="nav">
        <li><a href="index.html">홈</a></li>
        <li class="index"><a href="index.html" onclick="guideMenu(); return false;" id="guidesMenu">목차</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="L">
              <dt>시작</dt>
              <dd><a href="getting_started.html">레일즈 시작하기</a></dd>
              <dt>모델(Models)</dt>
              <dd><a href="migrations.html">레일즈 데이터베이스 마이그레이션</a></dd>
              <dd><a href="active_record_validations_callbacks.html">액티브 레코드 데이터 검증(Validation)과 Callback(콜백)</a></dd>
              <dd><a href="association_basics.html">액티브 레코드 Association(관계)</a></dd>
              <dd><a href="active_record_querying.html">액티브 레코드 쿼리 인터페이스</a></dd>
              <dt>뷰(Views)</dt>
              <dd><a href="layouts_and_rendering.html">레이아웃(Layouts)과 렌더링(Rendering)</a></dd>
              <dd><a href="form_helpers.html">액션 뷰 폼 핼퍼(Action View Form Helpers)</a></dd>
              <dt>컨트롤러(Controllers)</dt>
              <dd><a href="action_controller_overview.html">액션 컨트롤러 둘러보기</a></dd>
              <dd><a href="routing.html">외부 요청에 대한 레일즈 라우팅</a></dd>
            </dl>
            <dl class="R">
              <dt>심화내용</dt>
              <dd><a href="active_support_core_extensions.html">액티브 서포트(Active Support) 확장(Core Extensions)</a></dd>
              <dd><a href="i18n.html">레일즈 국제화I(nternationalization) API</a></dd>
              <dd><a href="action_mailer_basics.html">액션 메일러의 기본</a></dd>
              <dd><a href="testing.html">레일즈 어플리케이션 테스트하기</a></dd>
              <dd><a href="security.html">레일즈 어플리케이션의 보안</a></dd>
              <dd><a href="debugging_rails_applications.html">레일즈 어플리케이션 디버깅</a></dd>
              <dd><a href="performance_testing.html">레일즈 어플리케이션 성능 테스트하기</a></dd>
              <dd><a href="configuring.html">레일즈 어플리케이션 설정</a></dd>
              <dd><a href="command_line.html">레일즈 커멘드라인 도구와 Rake 테스크</a></dd>
              <dd><a href="caching_with_rails.html">레일즈를 이용한 캐싱</a></dd>

              <dt>레일즈 확장하기(Extending Rails)</dt>
              <dd><a href="plugins.html">레일즈 플러그인 작성의 기본</a></dd>
              <dd><a href="rails_on_rack.html">렉 위의 레일즈(Rails on Rack)</a></dd>
              <dd><a href="generators.html">레일즈 제너레이터(Generator) 제작과 수정</a></dd>

              <dt>루비 온 레이즈에 기여하기</dt>
              <dd><a href="contributing_to_ruby_on_rails.html">루비 온 레이즈에 기여하기</a></dd>
              <dd><a href="api_documentation_guidelines.html">API 문서 가이드라인</a></dd>
              <dd><a href="ruby_on_rails_guides_guidelines.html">루비 온 레일즈 가이드에 대한 가이드라인</a></dd>

              <dt>Release Notes</dt>
              <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes</a></dd>
              <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes</a></dd>
              <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes</a></dd>
            </dl>
          </div>
        </li>
        <li><a href="contribute.html">기여하기</a></li>
        <li><a href="credits.html">수고하신 분들</a></li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Active Support Core Extensions</h2>
<p>Active Support is the Ruby on Rails component responsible for providing Ruby language extensions, utilities, and other transversal stuff.</p>
<p>It offers a richer bottom-line at the language level, targeted both at the development of Rails applications, and at the development of Ruby on Rails itself.</p>
<p>By referring to this guide you will learn the extensions to the Ruby core classes and modules provided by Active Support.</p>

            <div id="subCol">
        <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
        <ol class="chapters">
<li><a href="#how-to-load-core-extensions">How to Load Core Extensions</a><ul><li><a href="#stand-alone-active-support">Stand-Alone Active Support</a></li> <li><a href="#active-support-within-a-ruby-on-rails-application">Active Support Within a Ruby on Rails Application</a></li></ul></li><li><a href="#extensions-to-all-objects">Extensions to All Objects</a><ul><li><a href="#blank-and-present"><tt>blank?</tt> and <tt>present?</tt></a></li> <li><a href="#presence"><tt>presence</tt></a></li> <li><a href="#duplicable"><tt>duplicable?</tt></a></li> <li><a href="#try"><tt>try</tt></a></li> <li><a href="#singleton_class"><tt>singleton_class</tt></a></li> <li><a href="#class_eval-args-block"><tt>class_eval(*args, &block)</tt></a></li> <li><a href="#acts_like-duck"><tt>acts_like?(duck)</tt></a></li> <li><a href="#to_param"><tt>to_param</tt></a></li> <li><a href="#to_query"><tt>to_query</tt></a></li> <li><a href="#with_options"><tt>with_options</tt></a></li> <li><a href="#instance-variables">Instance Variables</a></li> <li><a href="#silencing-warnings-streams-and-exceptions">Silencing Warnings, Streams, and Exceptions</a></li> <li><a href="#require_library_or_gem"><tt>require_library_or_gem</tt></a></li></ul></li><li><a href="#extensions-to-module">Extensions to <tt>Module</tt></a><ul><li><a href="#alias_method_chain"><tt>alias_method_chain</tt></a></li> <li><a href="#attributes">Attributes</a></li> <li><a href="#parents">Parents</a></li> <li><a href="#constants">Constants</a></li> <li><a href="#synchronization">Synchronization</a></li> <li><a href="#reachable">Reachable</a></li> <li><a href="#anonymous">Anonymous</a></li> <li><a href="#method-delegation">Method Delegation</a></li> <li><a href="#method-names">Method Names</a></li> <li><a href="#redefining-methods">Redefining Methods</a></li></ul></li><li><a href="#extensions-to-class">Extensions to <tt>Class</tt></a><ul><li><a href="#class-attributes">Class Attributes</a></li> <li><a href="#class-inheritable-attributes">Class Inheritable Attributes</a></li> <li><a href="#subclasses-descendants">Subclasses &amp; Descendants</a></li></ul></li><li><a href="#extensions-to-string">Extensions to <tt>String</tt></a><ul><li><a href="#output-safety">Output Safety</a></li> <li><a href="#squish"><tt>squish</tt></a></li> <li><a href="#truncate"><tt>truncate</tt></a></li> <li><a href="#key-based-interpolation">Key-based Interpolation</a></li> <li><a href="#starts_with-and-ends_with"><tt>starts_with?</tt> and <tt>ends_with?</tt></a></li> <li><a href="#strip_heredoc"><tt>strip_heredoc</tt></a></li> <li><a href="#access">Access</a></li> <li><a href="#inflections">Inflections</a></li> <li><a href="#string-conversions">Conversions</a></li></ul></li><li><a href="#extensions-to-numeric">Extensions to <tt>Numeric</tt></a><ul><li><a href="#bytes">Bytes</a></li></ul></li><li><a href="#extensions-to-integer">Extensions to <tt>Integer</tt></a><ul><li><a href="#multiple_of"><tt>multiple_of?</tt></a></li> <li><a href="#ordinalize"><tt>ordinalize</tt></a></li></ul></li><li><a href="#extensions-to-float">Extensions to <tt>Float</tt></a><ul><li><a href="#round"><tt>round</tt></a></li></ul></li><li><a href="#extensions-to-bigdecimal">Extensions to <tt>BigDecimal</tt></a></li><li><a href="#extensions-to-enumerable">Extensions to <tt>Enumerable</tt></a><ul><li><a href="#group_by"><tt>group_by</tt></a></li> <li><a href="#sum"><tt>sum</tt></a></li> <li><a href="#each_with_object"><tt>each_with_object</tt></a></li> <li><a href="#index_by"><tt>index_by</tt></a></li> <li><a href="#many"><tt>many?</tt></a></li> <li><a href="#exclude"><tt>exclude?</tt></a></li></ul></li><li><a href="#extensions-to-array">Extensions to <tt>Array</tt></a><ul><li><a href="#accessing">Accessing</a></li> <li><a href="#random-access">Random Access</a></li> <li><a href="#options-extraction">Options Extraction</a></li> <li><a href="#array-conversions">Conversions</a></li> <li><a href="#wrapping">Wrapping</a></li> <li><a href="#grouping">Grouping</a></li></ul></li><li><a href="#extensions-to-hash">Extensions to <tt>Hash</tt></a><ul><li><a href="#hash-conversions">Conversions</a></li> <li><a href="#merging">Merging</a></li> <li><a href="#diffing">Diffing</a></li> <li><a href="#working-with-keys">Working with Keys</a></li> <li><a href="#slicing">Slicing</a></li> <li><a href="#indifferent-access">Indifferent Access</a></li></ul></li><li><a href="#extensions-to-regexp">Extensions to <tt>Regexp</tt></a><ul><li><a href="#multiline"><tt>multiline?</tt></a></li></ul></li><li><a href="#extensions-to-range">Extensions to <tt>Range</tt></a><ul><li><a href="#to_s"><tt>to_s</tt></a></li> <li><a href="#step"><tt>step</tt></a></li> <li><a href="#include"><tt>include?</tt></a></li> <li><a href="#overlaps"><tt>overlaps?</tt></a></li></ul></li><li><a href="#extensions-to-proc">Extensions to <tt>Proc</tt></a><ul><li><a href="#bind"><tt>bind</tt></a></li></ul></li><li><a href="#extensions-to-date">Extensions to <tt>Date</tt></a><ul><li><a href="#calculations">Calculations</a></li> <li><a href="#date-conversions">Conversions</a></li></ul></li><li><a href="#extensions-to-datetime">Extensions to <tt>DateTime</tt></a><ul><li><a href="#calculations-datetime">Calculations</a></li></ul></li><li><a href="#extensions-to-time">Extensions to <tt>Time</tt></a><ul><li><a href="#time-calculations">Calculations</a></li> <li><a href="#time-constructors">Time Constructors</a></li></ul></li><li><a href="#extensions-to-process">Extensions to <tt>Process</tt></a><ul><li><a href="#daemon"><tt>daemon</tt></a></li></ul></li><li><a href="#extensions-to-file">Extensions to <tt>File</tt></a><ul><li><a href="#atomic_write"><tt>atomic_write</tt></a></li></ul></li><li><a href="#extensions-to-logger">Extensions to <tt>Logger</tt></a><ul><li><a href="#around_-level"><tt>around_[level]</tt></a></li> <li><a href="#silence"><tt>silence</tt></a></li> <li><a href="#datetime_format"><tt>datetime_format=</tt></a></li></ul></li><li><a href="#extensions-to-nameerror">Extensions to <tt>NameError</tt></a></li><li><a href="#extensions-to-loaderror">Extensions to <tt>LoadError</tt></a></li><li><a href="#changelog">Changelog</a></li></ol></div>
    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="how-to-load-core-extensions">1 How to Load Core Extensions</h3>
<h4 id="stand-alone-active-support">1.1 Stand-Alone Active Support</h4>
<p>In order to have a near zero default footprint, Active Support does not load anything by default. It is broken in small pieces so that you may load just what you need, and also has some convenience entry points to load related extensions in one shot, even everything.</p>
<p>Thus, after a simple require like:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
require 'active_support'
</pre>
</div>
</notextile>

<p>objects do not even respond to <tt>blank?</tt>, let&#8217;s see how to load its definition.</p>
<h5 id="cherry-picking-a-definition">1.1.1 Cherry-picking a Definition</h5>
<p>The most lightweight way to get <tt>blank?</tt> is to cherry-pick the file that defines it.</p>
<p>For every single method defined as a core extension this guide has a note that says where such a method is defined. In the case of <tt>blank?</tt> the note reads:</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/object/blank.rb</tt>.</p></div>
<p>That means that this single call is enough:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
require 'active_support/core_ext/object/blank'
</pre>
</div>
</notextile>

<p>Active Support has been carefully revised so that cherry-picking a file loads only strictly needed dependencies, if any.</p>
<h5 id="loading-grouped-core-extensions">1.1.2 Loading Grouped Core Extensions</h5>
<p>The next level is to simply load all extensions to <tt>Object</tt>. As a rule of thumb, extensions to <tt>SomeClass</tt> are available in one shot by loading <tt>active_support/core_ext/some_class</tt>.</p>
<p>Thus, if that would do, to have <tt>blank?</tt> available we could just load all extensions to <tt>Object</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
require 'active_support/core_ext/object'
</pre>
</div>
</notextile>

<h5 id="loading-all-core-extensions">1.1.3 Loading All Core Extensions</h5>
<p>You may prefer just to load all core extensions, there is a file for that:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
require 'active_support/core_ext'
</pre>
</div>
</notextile>

<h5 id="loading-all-active-support">1.1.4 Loading All Active Support</h5>
<p>And finally, if you want to have all Active Support available just issue:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
require 'active_support/all'
</pre>
</div>
</notextile>

<p>That does not even put the entire Active Support in memory upfront indeed, some stuff is configured via <tt>autoload</tt>, so it is only loaded if used.</p>
<h4 id="active-support-within-a-ruby-on-rails-application">1.2 Active Support Within a Ruby on Rails Application</h4>
<p>A Ruby on Rails application loads all Active Support unless <tt>config.active_support.bare</tt> is true. In that case, the application will only load what the framework itself cherry-picks for its own needs, and can still cherry-pick itself at any granularity level, as explained in the previous section.</p>
<h3 id="extensions-to-all-objects">2 Extensions to All Objects</h3>
<h4 id="blank-and-present">2.1 <tt>blank?</tt> and <tt>present?</tt></h4>
<p>The following values are considered to be blank in a Rails application:</p>
<ul>
	<li><tt>nil</tt> and <tt>false</tt>,</li>
</ul>
<ul>
	<li>strings composed only of whitespace, i.e. matching <tt>/\A\s*\z/</tt>,</li>
</ul>
<ul>
	<li>empty arrays and hashes, and</li>
</ul>
<ul>
	<li>any other object that responds to <tt>empty?</tt> and it is empty.</li>
</ul>
<div class='warning'><p>Note that numbers are not mentioned, in particular 0 and 0.0 are <strong>not</strong> blank.</p></div>
<p>For example, this method from <tt>ActionDispatch::Session::AbstractStore</tt> uses <tt>blank?</tt> for checking whether a session key is present:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def ensure_session_key!
  if @key.blank?
    raise ArgumentError, 'A key is required...'
  end
end
</pre>
</div>
</notextile>

<p>The method <tt>present?</tt> is equivalent to <tt>!blank?</tt>. This example is taken from <tt>ActionDispatch::Http::Cache::Response</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def set_conditional_cache_control!
  return if self[&quot;Cache-Control&quot;].present?
  ...
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/object/blank.rb</tt>.</p></div>
<h4 id="presence">2.2 <tt>presence</tt></h4>
<p>The <tt>presence</tt> method returns its receiver if <tt>present?</tt>, and <tt>nil</tt> otherwise. It is useful for idioms like this:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
host = config[:host].presence || 'localhost'
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/object/blank.rb</tt>.</p></div>
<h4 id="duplicable">2.3 <tt>duplicable?</tt></h4>
<p>A few fundamental objects in Ruby are singletons. For example, in the whole life of a program the integer 1 refers always to the same instance:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
1.object_id                 # =&gt; 3
Math.cos(0).to_i.object_id  # =&gt; 3
</pre>
</div>
</notextile>

<p>Hence, there&#8217;s no way these objects can be duplicated through <tt>dup</tt> or <tt>clone</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
true.dup  # =&gt; TypeError: can't dup TrueClass
</pre>
</div>
</notextile>

<p>Some numbers which are not singletons are not duplicable either:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
0.0.clone        # =&gt; allocator undefined for Float
(2**1024).clone  # =&gt; allocator undefined for Bignum
</pre>
</div>
</notextile>

<p>Active Support provides <tt>duplicable?</tt> to programmatically query an object about this property:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;&quot;.duplicable?     # =&gt; true
false.duplicable?  # =&gt; false
</pre>
</div>
</notextile>

<p>By definition all objects are <tt>duplicable?</tt> except <tt>nil</tt>, <tt>false</tt>, <tt>true</tt>, symbols, numbers, and class and module objects.</p>
<div class='warning'><p>Any class can disallow duplication removing <tt>dup</tt> and <tt>clone</tt> or raising exceptions from them, only <tt>rescue</tt> can tell whether a given arbitrary object is duplicable. <tt>duplicable?</tt> depends on the hard-coded list above, but it is much faster than <tt>rescue</tt>. Use it only if you know the hard-coded list is enough in your use case.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/object/duplicable.rb</tt>.</p></div>
<h4 id="try">2.4 <tt>try</tt></h4>
<p>Sometimes you want to call a method provided the receiver object is not <tt>nil</tt>, which is something you usually check first. <tt>try</tt> is like <tt>Object#send</tt> except that it returns <tt>nil</tt> if sent to <tt>nil</tt>.</p>
<p>For instance, in this code from <tt>ActiveRecord::ConnectionAdapters::AbstractAdapter</tt> <tt>@logger</tt> could be <tt>nil</tt>, but you save the check and write in an optimistic style:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def log_info(sql, name, ms)
  if @logger.try(:debug?)
    name = '%s (%.1fms)' % [name || 'SQL', ms]
    @logger.debug(format_log_entry(name, sql.squeeze(' ')))
  end
end
</pre>
</div>
</notextile>

<p><tt>try</tt> can also be called without arguments but a block, which will only be executed if the object is not nil:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@person.try { |p| &quot;#{p.first_name} #{p.last_name}&quot; }
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/object/try.rb</tt>.</p></div>
<h4 id="singleton_class">2.5 <tt>singleton_class</tt></h4>
<p>The method <tt>singleton_class</tt> returns the singleton class of the receiver:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
String.singleton_class     # =&gt; #&lt;Class:String&gt;
String.new.singleton_class # =&gt; #&lt;Class:#&lt;String:0x17a1d1c&gt;&gt;
</pre>
</div>
</notextile>

<div class='warning'><p>Fixnums and symbols have no singleton classes, <tt>singleton_class</tt> raises <tt>TypeError</tt> on them. Moreover, the singleton classes of <tt>nil</tt>, <tt>true</tt>, and <tt>false</tt>, are <tt>NilClass</tt>, <tt>TrueClass</tt>, and <tt>FalseClass</tt>, respectively.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/kernel/singleton_class.rb</tt>.</p></div>
<h4 id="class_eval-args-block">2.6 <tt>class_eval(*args, &block)</tt></h4>
<p>You can evaluate code in the context of any object&#8217;s singleton class using <tt>class_eval</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Proc
  def bind(object)
    block, time = self, Time.now
    object.class_eval do
      method_name = &quot;__bind_#{time.to_i}_#{time.usec}&quot;
      define_method(method_name, &amp;block)
      method = instance_method(method_name)
      remove_method(method_name)
      method
    end.bind(object)
  end
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/kernel/singleton_class.rb</tt>.</p></div>
<h4 id="acts_like-duck">2.7 <tt>acts_like?(duck)</tt></h4>
<p>The method <tt>acts_like</tt> provides a way to check whether some class acts like some other class based on a simple convention: a class that provides the same interface as <tt>String</tt> defines</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def acts_like_string?
end
</pre>
</div>
</notextile>

<p>which is only a marker, its body or return value are irrelevant. Then, client code can query for duck-type-safeness this way:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
some_klass.acts_like?(:string)
</pre>
</div>
</notextile>

<p>Rails has classes that act like <tt>Date</tt> or <tt>Time</tt> and follow this contract.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/object/acts_like.rb</tt>.</p></div>
<h4 id="to_param">2.8 <tt>to_param</tt></h4>
<p>All objects in Rails respond to the method <tt>to_param</tt>, which is meant to return something that represents them as values in a query string, or as <span class="caps">URL</span> fragments.</p>
<p>By default <tt>to_param</tt> just calls <tt>to_s</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
7.to_param # =&gt; &quot;7&quot;
</pre>
</div>
</notextile>

<p>The return value of <tt>to_param</tt> should <strong>not</strong> be escaped:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;Tom &amp; Jerry&quot;.to_param # =&gt; &quot;Tom &amp; Jerry&quot;
</pre>
</div>
</notextile>

<p>Several classes in Rails overwrite this method.</p>
<p>For example <tt>nil</tt>, <tt>true</tt>, and <tt>false</tt> return themselves. <tt>Array#to_param</tt> calls <tt>to_param</tt> on the elements and joins the result with &#8220;/&#8221;:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[0, true, String].to_param # =&gt; &quot;0/true/String&quot;
</pre>
</div>
</notextile>

<p>Notably, the Rails routing system calls <tt>to_param</tt> on models to get a value for the <tt>:id</tt> placeholder. <tt>ActiveRecord::Base#to_param</tt> returns the <tt>id</tt> of a model, but you can redefine that method in your models. For example, given</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User
  def to_param
    &quot;#{id}-#{name.parameterize}&quot;
  end
end
</pre>
</div>
</notextile>

<p>we get:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
user_path(@user) # =&gt; &quot;/users/357-john-smith&quot;
</pre>
</div>
</notextile>

<div class='warning'><p>Controllers need to be aware of any redefinition of <tt>to_param</tt> because when a request like that comes in &#8220;357-john-smith&#8221; is the value of <tt>params[:id]</tt>.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/object/to_param.rb</tt>.</p></div>
<h4 id="to_query">2.9 <tt>to_query</tt></h4>
<p>Except for hashes, given an unescaped <tt>key</tt> this method constructs the part of a query string that would map such key to what <tt>to_param</tt> returns. For example, given</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User
  def to_param
    &quot;#{id}-#{name.parameterize}&quot;
  end
end
</pre>
</div>
</notextile>

<p>we get:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
current_user.to_query('user') # =&gt; user=357-john-smith
</pre>
</div>
</notextile>

<p>This method escapes whatever is needed, both for the key and the value:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
account.to_query('company[name]')
# =&gt; &quot;company%5Bname%5D=Johnson+%26+Johnson&quot;
</pre>
</div>
</notextile>

<p>so its output is ready to be used in a query string.</p>
<p>Arrays return the result of applying <tt>to_query</tt> to each element with <tt><em>key</em>[]</tt> as key, and join the result with &#8220;&amp;&#8221;:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[3.4, -45.6].to_query('sample')
# =&gt; &quot;sample%5B%5D=3.4&amp;sample%5B%5D=-45.6&quot;
</pre>
</div>
</notextile>

<p>Hashes also respond to <tt>to_query</tt> but with a different signature. If no argument is passed a call generates a sorted series of key/value assignments calling <tt>to_query(key)</tt> on its values. Then it joins the result with &#8220;&amp;&#8221;:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{:c =&gt; 3, :b =&gt; 2, :a =&gt; 1}.to_query # =&gt; &quot;a=1&amp;b=2&amp;c=3&quot;
</pre>
</div>
</notextile>

<p>The method <tt>Hash#to_query</tt> accepts an optional namespace for the keys:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{:id =&gt; 89, :name =&gt; &quot;John Smith&quot;}.to_query('user')
# =&gt; &quot;user%5Bid%5D=89&amp;user%5Bname%5D=John+Smith&quot;
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/object/to_query.rb</tt>.</p></div>
<h4 id="with_options">2.10 <tt>with_options</tt></h4>
<p>The method <tt>with_options</tt> provides a way to factor out common options in a series of method calls.</p>
<p>Given a default options hash, <tt>with_options</tt> yields a proxy object to a block. Within the block, methods called on the proxy are forwarded to the receiver with their options merged. For example, you get rid of the duplication in:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Account &lt; ActiveRecord::Base
  has_many :customers, :dependent =&gt; :destroy
  has_many :products,  :dependent =&gt; :destroy
  has_many :invoices,  :dependent =&gt; :destroy
  has_many :expenses,  :dependent =&gt; :destroy
end
</pre>
</div>
</notextile>

<p>this way:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Account &lt; ActiveRecord::Base
  with_options :dependent =&gt; :destroy do |assoc|
    assoc.has_many :customers
    assoc.has_many :products
    assoc.has_many :invoices
    assoc.has_many :expenses
  end
end
</pre>
</div>
</notextile>

<p>That idiom may convey <em>grouping</em> to the reader as well. For example, say you want to send a newsletter whose language depends on the user. Somewhere in the mailer you could group locale-dependent bits like this:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
I18n.with_options :locale =&gt; user.locale, :scope =&gt; &quot;newsletter&quot; do |i18n|
  subject i18n.t :subject
  body    i18n.t :body, :user_name =&gt; user.name
end
</pre>
</div>
</notextile>

<div class='info'><p>Since <tt>with_options</tt> forwards calls to its receiver they can be nested. Each nesting level will merge inherited defaults in addition to their own.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/object/with_options.rb</tt>.</p></div>
<h4 id="instance-variables">2.11 Instance Variables</h4>
<p>Active Support provides several methods to ease access to instance variables.</p>
<h5 id="instance_variable_names">2.11.1 <tt>instance_variable_names</tt></h5>
<p>Ruby 1.8 and 1.9 have a method called <tt>instance_variables</tt> that returns the names of the defined instance variables. But they behave differently, in 1.8 it returns strings whereas in 1.9 it returns symbols. Active Support defines <tt>instance_variable_names</tt> as a portable way to obtain them as strings:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_variable_names # =&gt; [&quot;@y&quot;, &quot;@x&quot;]
</pre>
</div>
</notextile>

<div class='warning'><p>The order in which the names are returned is unspecified, and it indeed depends on the version of the interpreter.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/object/instance_variables.rb</tt>.</p></div>
<h5 id="instance_values">2.11.2 <tt>instance_values</tt></h5>
<p>The method <tt>instance_values</tt> returns a hash that maps instance variable names without &#8220;@&#8221; to their
corresponding values. Keys are strings both in Ruby 1.8 and 1.9:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_values # =&gt; {&quot;x&quot; =&gt; 0, &quot;y&quot; =&gt; 1}
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/object/instance_variables.rb</tt>.</p></div>
<h4 id="silencing-warnings-streams-and-exceptions">2.12 Silencing Warnings, Streams, and Exceptions</h4>
<p>The methods <tt>silence_warnings</tt> and <tt>enable_warnings</tt> change the value of <tt>$VERBOSE</tt> accordingly for the duration of their block, and reset it afterwards:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
silence_warnings { Object.const_set &quot;RAILS_DEFAULT_LOGGER&quot;, logger }
</pre>
</div>
</notextile>

<p>You can silence any stream while a block runs with <tt>silence_stream</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
silence_stream(STDOUT) do
  # STDOUT is silent here
end
</pre>
</div>
</notextile>

<p>Silencing exceptions is also possible with <tt>suppress</tt>. This method receives an arbitrary number of exception classes. If an exception is raised during the execution of the block and is <tt>kind_of?</tt> any of the arguments, <tt>suppress</tt> captures it and returns silently. Otherwise the exception is reraised:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# If the user is locked the increment is lost, no big deal.
suppress(ActiveRecord::StaleObjectError) do
  current_user.increment! :visits
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/kernel/reporting.rb</tt>.</p></div>
<h4 id="require_library_or_gem">2.13 <tt>require_library_or_gem</tt></h4>
<p>The convenience method <tt>require_library_or_gem</tt> tries to load its argument with a regular <tt>require</tt> first. If it fails loads <tt>rubygems</tt> and tries again.</p>
<p>If the first attempt is a failure and <tt>rubygems</tt> can&#8217;t be loaded the method raises <tt>LoadError</tt>. On the other hand, if <tt>rubygems</tt> is available but the argument is not loadable as a gem, the method gives up and <tt>LoadError</tt> is also raised.</p>
<p>For example, that&#8217;s the way the MySQL adapter loads the MySQL library:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
require_library_or_gem('mysql')
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/kernel/requires.rb</tt>.</p></div>
<h3 id="extensions-to-module">3 Extensions to <tt>Module</tt></h3>
<h4 id="alias_method_chain">3.1 <tt>alias_method_chain</tt></h4>
<p>Using plain Ruby you can wrap methods with other methods, that&#8217;s called <em>alias chaining</em>.</p>
<p>For example, let&#8217;s say you&#8217;d like params to be strings in functional tests, as they are in real requests, but still want the convenience of assigning integers and other kind of values. To accomplish that you could wrap <tt>ActionController::TestCase#process</tt> this way in <tt>test/test_helper.rb</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
ActionController::TestCase.class_eval do
  # save a reference to the original process method
  alias_method :original_process, :process

  # now redefine process and delegate to original_process
  def process(action, params=nil, session=nil, flash=nil, http_method='GET')
    params = Hash[*params.map {|k, v| [k, v.to_s]}.flatten]
    original_process(action, params, session, flash, http_method)
  end
end
</pre>
</div>
</notextile>

<p>That&#8217;s the method <tt>get</tt>, <tt>post</tt>, etc., delegate the work to.</p>
<p>That technique has a risk, it could be the case that <tt>:original_process</tt> was taken. To try to avoid collisions people choose some label that characterizes what the chaining is about:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
ActionController::TestCase.class_eval do
  def process_with_stringified_params(...)
    params = Hash[*params.map {|k, v| [k, v.to_s]}.flatten]
    process_without_stringified_params(action, params, session, flash, http_method)
  end
  alias_method :process_without_stringified_params, :process
  alias_method :process, :process_with_stringified_params
end
</pre>
</div>
</notextile>

<p>The method <tt>alias_method_chain</tt> provides a shortcut for that pattern:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
ActionController::TestCase.class_eval do
  def process_with_stringified_params(...)
    params = Hash[*params.map {|k, v| [k, v.to_s]}.flatten]
    process_without_stringified_params(action, params, session, flash, http_method)
  end
  alias_method_chain :process, :stringified_params
end
</pre>
</div>
</notextile>

<p>Rails uses <tt>alias_method_chain</tt> all over the code base. For example validations are added to <tt>ActiveRecord::Base#save</tt> by wrapping the method that way in a separate module specialised in validations.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/module/aliasing.rb</tt>.</p></div>
<h4 id="attributes">3.2 Attributes</h4>
<h5 id="alias_attribute">3.2.1 <tt>alias_attribute</tt></h5>
<p>Model attributes have a reader, a writer, and a predicate. You can alias a model attribute having the corresponding three methods defined for you in one shot. As in other aliasing methods, the new name is the first argument, and the old name is the second (my mnemonic is they go in the same order as if you did an assignment):</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ActiveRecord::Base
  # let me refer to the email column as &quot;login&quot;,
  # much meaningful for authentication code
  alias_attribute :login, :email
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/module/aliasing.rb</tt>.</p></div>
<h5 id="attr_accessor_with_default">3.2.2 <tt>attr_accessor_with_default</tt></h5>
<p>The method <tt>attr_accessor_with_default</tt> serves the same purpose as the Ruby macro <tt>attr_accessor</tt> but allows you to set a default value for the attribute:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Url
  attr_accessor_with_default :port, 80
end

Url.new.port # =&gt; 80
</pre>
</div>
</notextile>

<p>The default value can be also specified with a block, which is called in the context of the corresponding object:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User
  attr_accessor :name, :surname
  attr_accessor_with_default(:full_name) {
	[name, surname].compact.join(&quot; &quot;)
  }
end

u = User.new
u.name = 'Xavier'
u.surname = 'Noria'
u.full_name # =&gt; &quot;Xavier Noria&quot;
</pre>
</div>
</notextile>

<p>The result is not cached, the block is invoked in each call to the reader.</p>
<p>You can overwrite the default with the writer:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
url = Url.new
url.host # =&gt; 80
url.host = 8080
url.host # =&gt; 8080
</pre>
</div>
</notextile>

<p>The default value is returned as long as the attribute is unset. The reader does not rely on the value of the attribute to know whether it has to return the default. It rather monitors the writer: if there&#8217;s any assignment the value is no longer considered to be unset.</p>
<p>Active Resource uses this macro to set a default value for the <tt>:primary_key</tt> attribute:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
attr_accessor_with_default :primary_key, 'id'
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/module/attr_accessor_with_default.rb</tt>.</p></div>
<h5 id="internal-attributes">3.2.3 Internal Attributes</h5>
<p>When you are defining an attribute in a class that is meant to be subclassed name collisions are a risk. That&#8217;s remarkably important for libraries.</p>
<p>Active Support defines the macros <tt>attr_internal_reader</tt>, <tt>attr_internal_writer</tt>, and <tt>attr_internal_accessor</tt>. They behave like their Ruby built-in <tt>attr_*</tt> counterparts, except they name the underlying instance variable in a way that makes collisions less likely.</p>
<p>The macro <tt>attr_internal</tt> is a synonym for <tt>attr_internal_accessor</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# library
class ThirdPartyLibrary::Crawler
  attr_internal :log_level
end

# client code
class MyCrawler &lt; ThirdPartyLibrary::Crawler
  attr_accessor :log_level
end
</pre>
</div>
</notextile>

<p>In the previous example it could be the case that <tt>:log_level</tt> does not belong to the public interface of the library and it is only used for development. The client code, unaware of the potential conflict, subclasses and defines its own <tt>:log_level</tt>. Thanks to <tt>attr_internal</tt> there&#8217;s no collision.</p>
<p>By default the internal instance variable is named with a leading underscore, <tt>@_log_level</tt> in the example above. That&#8217;s configurable via <tt>Module.attr_internal_naming_format</tt> though, you can pass any <tt>sprintf</tt>-like format string with a leading <tt>@</tt> and a <tt>%s</tt> somewhere, which is where the name will be placed. The default is <tt>"@_%s"</tt>.</p>
<p>Rails uses internal attributes in a few spots, for examples for views:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module ActionView
  class Base
    attr_internal :captures
    attr_internal :request, :layout
    attr_internal :controller, :template
  end
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/module/attr_internal.rb</tt>.</p></div>
<h5 id="module-attributes">3.2.4 Module Attributes</h5>
<p>The macros <tt>mattr_reader</tt>, <tt>mattr_writer</tt>, and <tt>mattr_accessor</tt> are analogous to the <tt>cattr_*</tt> macros defined for class. Check <a href="#class-attributes">Class Attributes</a>.</p>
<p>For example, the dependencies mechanism uses them:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module ActiveSupport
  module Dependencies
    mattr_accessor :warnings_on_first_load
    mattr_accessor :history
    mattr_accessor :loaded
    mattr_accessor :mechanism
    mattr_accessor :load_paths
    mattr_accessor :load_once_paths
    mattr_accessor :autoloaded_constants
    mattr_accessor :explicitly_unloadable_constants
    mattr_accessor :logger
    mattr_accessor :log_activity
    mattr_accessor :constant_watch_stack
    mattr_accessor :constant_watch_stack_mutex
  end
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/module/attribute_accessors.rb</tt>.</p></div>
<h4 id="parents">3.3 Parents</h4>
<h5 id="parent">3.3.1 <tt>parent</tt></h5>
<p>The <tt>parent</tt> method on a nested named module returns the module that contains its corresponding constant:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.parent # =&gt; X::Y
M.parent       # =&gt; X::Y
</pre>
</div>
</notextile>

<p>If the module is anonymous or belongs to the top-level, <tt>parent</tt> returns <tt>Object</tt>.</p>
<div class='warning'><p>Note that in that case <tt>parent_name</tt> returns <tt>nil</tt>.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/module/introspection.rb</tt>.</p></div>
<h5 id="parent_name">3.3.2 <tt>parent_name</tt></h5>
<p>The <tt>parent_name</tt> method on a nested named module returns the fully-qualified name of the module that contains its corresponding constant:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.parent_name # =&gt; &quot;X::Y&quot;
M.parent_name       # =&gt; &quot;X::Y&quot;
</pre>
</div>
</notextile>

<p>For top-level or anonymous modules <tt>parent_name</tt> returns <tt>nil</tt>.</p>
<div class='warning'><p>Note that in that case <tt>parent</tt> returns <tt>Object</tt>.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/module/introspection.rb</tt>.</p></div>
<h5 id="module-parents">3.3.3 <tt>parents</tt></h5>
<p>The method <tt>parents</tt> calls <tt>parent</tt> on the receiver and upwards until <tt>Object</tt> is reached. The chain is returned in an array, from bottom to top:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.parents # =&gt; [X::Y, X, Object]
M.parents       # =&gt; [X::Y, X, Object]
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/module/introspection.rb</tt>.</p></div>
<h4 id="constants">3.4 Constants</h4>
<p>The method <tt>local_constants</tt> returns the names of the constants that have been defined in the receiver module:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module X
  X1 = 1
  X2 = 2
  module Y
    Y1 = :y1
    X1 = :overrides_X1_above
  end
end

X.local_constants    # =&gt; [&quot;X2&quot;, &quot;X1&quot;, &quot;Y&quot;], assumes Ruby 1.8
X::Y.local_constants # =&gt; [&quot;X1&quot;, &quot;Y1&quot;], assumes Ruby 1.8
</pre>
</div>
</notextile>

<p>The names are returned as strings in Ruby 1.8, and as symbols in Ruby 1.9. The method <tt>local_constant_names</tt> returns always strings.</p>
<div class='warning'><p>This method is exact if running under Ruby 1.9. In previous versions it may miss some constants if their value in some ancestor stores the exact same object than in the receiver.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/module/introspection.rb</tt>.</p></div>
<h4 id="synchronization">3.5 Synchronization</h4>
<p>The <tt>synchronize</tt> macro declares a method to be synchronized:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Counter
  @@mutex = Mutex.new
  attr_reader :value

  def initialize
    @value = 0
  end

  def incr
    @value += 1 # non-atomic
  end
  synchronize :incr, :with =&gt; '@@mutex'
end
</pre>
</div>
</notextile>

<p>The method receives the name of an action, and a <tt>:with</tt> option with code. The code is evaluated in the context of the receiver each time the method is invoked, and it should evaluate to a <tt>Mutex</tt> instance or any other object that responds to <tt>synchronize</tt> and accepts a block.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/module/synchronization.rb</tt>.</p></div>
<h4 id="reachable">3.6 Reachable</h4>
<p>A named module is reachable if it is stored in its corresponding constant. It means you can reach the module object via the constant.</p>
<p>That is what ordinarily happens, if a module is called &#8220;M&#8221;, the <tt>M</tt> constant exists and holds it:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module M
end

M.reachable? # =&gt; true
</pre>
</div>
</notextile>

<p>But since constants and modules are indeed kind of decoupled, module objects can become unreachable:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module M
end

orphan = Object.send(:remove_const, :M)

# The module object is orphan now but it still has a name.
orphan.name # =&gt; &quot;M&quot;

# You cannot reach it via the constant M because it does not even exist.
orphan.reachable? # =&gt; false

# Let's define a module called &quot;M&quot; again.
module M
end

# The constant M exists now again, and it stores a module
# object called &quot;M&quot;, but it is a new instance.
orphan.reachable? # =&gt; false
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/module/reachable.rb</tt>.</p></div>
<h4 id="anonymous">3.7 Anonymous</h4>
<p>A module may or may not have a name:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module M
end
M.name # =&gt; &quot;M&quot;

N = Module.new
N.name # =&gt; &quot;N&quot;

Module.new.name # =&gt; &quot;&quot; in 1.8, nil in 1.9
</pre>
</div>
</notextile>

<p>You can check whether a module has a name with the predicate <tt>anonymous?</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module M
end
M.anonymous? # =&gt; false

Module.new.anonymous? # =&gt; true
</pre>
</div>
</notextile>

<p>Note that being unreachable does not imply being anonymous:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module M
end

m = Object.send(:remove_const, :M)

m.reachable? # =&gt; false
m.anonymous? # =&gt; false
</pre>
</div>
</notextile>

<p>though an anonymous module is unreachable by definition.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/module/anonymous.rb</tt>.</p></div>
<h4 id="method-delegation">3.8 Method Delegation</h4>
<p>The macro <tt>delegate</tt> offers an easy way to forward methods.</p>
<p>Let&#8217;s imagine that users in some application have login information in the <tt>User</tt> model but name and other data in a separate <tt>Profile</tt> model:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ActiveRecord::Base
  has_one :profile
end
</pre>
</div>
</notextile>

<p>With that configuration you get a user&#8217;s name via his profile, <tt>user.profile.name</tt>, but it could be handy to still be able to access such attribute directly:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ActiveRecord::Base
  has_one :profile

  def name
    profile.name
  end
end
</pre>
</div>
</notextile>

<p>That is what <tt>delegate</tt> does for you:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ActiveRecord::Base
  has_one :profile

  delegate :name, :to =&gt; :profile
end
</pre>
</div>
</notextile>

<p>It is shorter, and the intention more obvious.</p>
<p>The macro accepts several methods:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
delegate :name, :age, :address, :twitter, :to =&gt; :profile
</pre>
</div>
</notextile>

<p>When interpolated into a string, the <tt>:to</tt> option should become an expression that evaluates to the object the method is delegated to. Typically a string or symbol. Such a expression is evaluated in the context of the receiver:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# delegates to the Rails constant
delegate :logger, :to =&gt; :Rails

# delegates to the receiver's class
delegate :table_name, :to =&gt; 'self.class'
</pre>
</div>
</notextile>

<div class='warning'><p>If the <tt>:prefix</tt> option is <tt>true</tt> this is less generic, see below.</p></div>
<p>By default, if the delegation raises <tt>NoMethodError</tt> and the target is <tt>nil</tt> the exception is propagated. You can ask that <tt>nil</tt> is returned instead with the <tt>:allow_nil</tt> option:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
delegate :name, :to =&gt; :profile, :allow_nil =&gt; true
</pre>
</div>
</notextile>

<p>With <tt>:allow_nil</tt> the call <tt>user.name</tt> returns <tt>nil</tt> if the user has no profile.</p>
<p>The option <tt>:prefix</tt> adds a prefix to the name of the generated method. This may be handy for example to get a better name:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
delegate :street, :to =&gt; :address, :prefix =&gt; true
</pre>
</div>
</notextile>

<p>The previous example generates <tt>address_street</tt> rather than <tt>street</tt>.</p>
<div class='warning'><p>Since in this case the name of the generated method is composed of the target object and target method names, the <tt>:to</tt> option must be a method name.</p></div>
<p>A custom prefix may also be configured:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
delegate :size, :to =&gt; :attachment, :prefix =&gt; :avatar
</pre>
</div>
</notextile>

<p>In the previous example the macro generates <tt>avatar_size</tt> rather than <tt>size</tt>.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/module/delegation.rb</tt></p></div>
<h4 id="method-names">3.9 Method Names</h4>
<p>The builtin methods <tt>instance_methods</tt> and <tt>methods</tt> return method names as strings or symbols depending on the Ruby version. Active Support defines <tt>instance_method_names</tt> and <tt>method_names</tt> to be equivalent to them, respectively, but always getting strings back.</p>
<p>For example, <tt>ActionView::Helpers::FormBuilder</tt> knows this array difference is going to work no matter the Ruby version:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
self.field_helpers = (FormHelper.instance_method_names - ['form_for'])
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/module/method_names.rb</tt></p></div>
<h4 id="redefining-methods">3.10 Redefining Methods</h4>
<p>There are cases where you need to define a method with <tt>define_method</tt>, but don&#8217;t know whether a method with that name already exists. If it does, a warning is issued if they are enabled. No big deal, but not clean either.</p>
<p>The method <tt>redefine_method</tt> prevents such a potential warning, removing the existing method before if needed. Rails uses it in a few places, for instance when it generates an association&#8217;s <span class="caps">API</span>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
redefine_method(&quot;#{reflection.name}=&quot;) do |new_value|
  association = association_instance_get(reflection.name)

  if association.nil? || association.target != new_value
    association = association_proxy_class.new(self, reflection)
  end

  association.replace(new_value)
  association_instance_set(reflection.name, new_value.nil? ? nil : association)
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/module/remove_method.rb</tt></p></div>
<h3 id="extensions-to-class">4 Extensions to <tt>Class</tt></h3>
<h4 id="class-attributes">4.1 Class Attributes</h4>
<h5 id="class_attribute">4.1.1 <tt>class_attribute</tt></h5>
<p>The method <tt>class_attribute</tt> declares one or more inheritable class attributes that can be overridden at any level down the hierarchy:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class A
  class_attribute :x
end

class B &lt; A; end

class C &lt; B; end

A.x = :a
B.x # =&gt; :a
C.x # =&gt; :a

B.x = :b
A.x # =&gt; :a
C.x # =&gt; :b

C.x = :c
A.x # =&gt; :a
B.x # =&gt; :b
</pre>
</div>
</notextile>

<p>For example <tt>ActionMailer::Base</tt> defines:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class_attribute :default_params
self.default_params = {
  :mime_version =&gt; &quot;1.0&quot;,
  :charset      =&gt; &quot;UTF-8&quot;,
  :content_type =&gt; &quot;text/plain&quot;,
  :parts_order  =&gt; [ &quot;text/plain&quot;, &quot;text/enriched&quot;, &quot;text/html&quot; ]
}.freeze
</pre>
</div>
</notextile>

<p>They can be also accessed and overridden at the instance level:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
A.x = 1

a1 = A.new
a2 = A.new
a2.x = 2

a1.x # =&gt; 1, comes from A
a2.x # =&gt; 2, overridden in a2
</pre>
</div>
</notextile>

<p>The generation of the writer instance method can be prevented by setting the option <tt>:instance_writer</tt> to false, as in</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module ActiveRecord
  class Base
    class_attribute :table_name_prefix, :instance_writer =&gt; false
    self.table_name_prefix = &quot;&quot;
  end
end
</pre>
</div>
</notextile>

<p>A model may find that option useful as a way to prevent mass-assignment from setting the attribute.</p>
<p>For convenience <tt>class_attribute</tt> also defines an instance predicate which is the double negation of what the instance reader returns. In the examples above it would be called <tt>x?</tt>.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/class/attribute.rb</tt></p></div>
<h5 id="cattr_reader-cattr_writer-and-cattr_accessor">4.1.2 <tt>cattr_reader</tt>, <tt>cattr_writer</tt>, and <tt>cattr_accessor</tt></h5>
<p>The macros <tt>cattr_reader</tt>, <tt>cattr_writer</tt>, and <tt>cattr_accessor</tt> are analogous to their <tt>attr_*</tt> counterparts but for classes. They initialize a class variable to <tt>nil</tt> unless it already exists, and generate the corresponding class methods to access it:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class MysqlAdapter &lt; AbstractAdapter
  # Generates class methods to access @@emulate_booleans.
  cattr_accessor :emulate_booleans
  self.emulate_booleans = true
end
</pre>
</div>
</notextile>

<p>Instance methods are created as well for convenience, they are just proxies to the class attribute. So, instances can change the class attribute, but cannot override it as it happens with <tt>class_attribute</tt> (see above). For example given</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module ActionView
  class Base
    cattr_accessor :field_error_proc
    @@field_error_proc = Proc.new{ ... }
  end
end
</pre>
</div>
</notextile>

<p>we can access <tt>field_error_proc</tt> in views. The generation of the writer instance method can be prevented by setting <tt>:instance_writer</tt> to <tt>false</tt> (not any false value, but exactly <tt>false</tt>):</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module ActiveRecord
  class Base
    # No pluralize_table_names= instance writer is generated.
    cattr_accessor :pluralize_table_names, :instance_writer =&gt; false
  end
end
</pre>
</div>
</notextile>

<p>A model may find that option useful as a way to prevent mass-assignment from setting the attribute.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/class/attribute_accessors.rb</tt>.</p></div>
<h4 id="class-inheritable-attributes">4.2 Class Inheritable Attributes</h4>
<p>Class variables are shared down the inheritance tree. Class instance variables are not shared, but they are not inherited either. The macros <tt>class_inheritable_reader</tt>, <tt>class_inheritable_writer</tt>, and <tt>class_inheritable_accessor</tt> provide accessors for class-level data which is inherited but not shared with children:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module ActionController
  class Base
    # FIXME: REVISE/SIMPLIFY THIS COMMENT.
    # The value of allow_forgery_protection is inherited,
    # but its value in a particular class does not affect
    # the value in the rest of the controllers hierarchy.
    class_inheritable_accessor :allow_forgery_protection
  end
end
</pre>
</div>
</notextile>

<p>They accomplish this with class instance variables and cloning on subclassing, there are no class variables involved. Cloning is performed with <tt>dup</tt> as long as the value is duplicable.</p>
<p>There are some variants specialised in arrays and hashes:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class_inheritable_array
class_inheritable_hash
</pre>
</div>
</notextile>

<p>Those writers take any inherited array or hash into account and extend them rather than overwrite them.</p>
<p>As with vanilla class attribute accessors these macros create convenience instance methods for reading and writing. The generation of the writer instance method can be prevented setting <tt>:instance_writer</tt> to <tt>false</tt> (not any false value, but exactly <tt>false</tt>):</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module ActiveRecord
  class Base
    class_inheritable_accessor :default_scoping, :instance_writer =&gt; false
  end
end
</pre>
</div>
</notextile>

<p>Since values are copied when a subclass is defined, if the base class changes the attribute after that, the subclass does not see the new value. That&#8217;s the point.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/class/inheritable_attributes.rb</tt>.</p></div>
<h4 id="subclasses-descendants">4.3 Subclasses &amp; Descendants</h4>
<h5 id="subclasses">4.3.1 <tt>subclasses</tt></h5>
<p>The <tt>subclasses</tt> method returns the subclasses of the receiver:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class C; end
C.subclasses # =&gt; []

class B &lt; C; end
C.subclasses # =&gt; [B]

class A &lt; B; end
C.subclasses # =&gt; [B]

class D &lt; C; end
C.subclasses # =&gt; [B, D]
</pre>
</div>
</notextile>

<p>The order in which these classes are returned is unspecified.</p>
<div class='warning'><p>This method is redefined in some Rails core classes but should be all compatible in Rails 3.1.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/class/subclasses.rb</tt>.</p></div>
<h5 id="descendants">4.3.2 <tt>descendants</tt></h5>
<p>The <tt>descendants</tt> method returns all classes that are <tt>&lt;</tt> than its receiver:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class C; end
C.descendants # =&gt; []

class B &lt; C; end
C.descendants # =&gt; [B]

class A &lt; B; end
C.descendants # =&gt; [B, A]

class D &lt; C; end
C.descendants # =&gt; [B, A, D]
</pre>
</div>
</notextile>

<p>The order in which these classes are returned is unspecified.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/class/subclasses.rb</tt>.</p></div>
<h3 id="extensions-to-string">5 Extensions to <tt>String</tt></h3>
<h4 id="output-safety">5.1 Output Safety</h4>
<p>Inserting data into <span class="caps">HTML</span> templates needs extra care. For example you can&#8217;t just interpolate <tt>@review.title</tt> verbatim into an <span class="caps">HTML</span> page. On one hand if the review title is &#8220;Flanagan &amp; Matz rules!&#8221; the output won&#8217;t be well-formed because an ampersand has to be escaped as &#8220;&amp;amp;&#8221;. On the other hand, depending on the application that may be a big security hole because users can inject malicious <span class="caps">HTML</span> setting a hand-crafted review title. Check out the <a href="security.html#cross-site-scripting-xss">section about cross-site scripting in the Security guide</a> for further information about the risks.</p>
<p>Active Support has the concept of <i>(html) safe</i> strings since Rails 3. A safe string is one that is marked as being insertable into <span class="caps">HTML</span> as is. It is trusted, no matter whether it has been escaped or not.</p>
<p>Strings are considered to be <i>unsafe</i> by default:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;&quot;.html_safe? # =&gt; false
</pre>
</div>
</notextile>

<p>You can obtain a safe string from a given one with the <tt>html_safe</tt> method:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
s = &quot;&quot;.html_safe
s.html_safe? # =&gt; true
</pre>
</div>
</notextile>

<p>It is important to understand that <tt>html_safe</tt> performs no escaping whatsoever, it is just an assertion:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
s = &quot;&lt;script&gt;...&lt;/script&gt;&quot;.html_safe
s.html_safe? # =&gt; true
s            # =&gt; &quot;&lt;script&gt;...&lt;/script&gt;&quot;
</pre>
</div>
</notextile>

<p>It is your responsibility to ensure calling <tt>html_safe</tt> on a particular string is fine.</p>
<div class='note'><p>For performance reasons safe strings are implemented in a way that cannot offer an in-place <tt>html_safe!</tt> variant.</p></div>
<p>If you append onto a safe string, either in-place with <tt>concat</tt>/<tt>&lt;&lt;</tt>, or with <tt>+</tt>, the result is a safe string. Unsafe arguments are escaped:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;&quot;.html_safe + &quot;&lt;&quot; # =&gt; &quot;&amp;lt;&quot;
</pre>
</div>
</notextile>

<p>Safe arguments are directly appended:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;&quot;.html_safe + &quot;&lt;&quot;.html_safe # =&gt; &quot;&lt;&quot;
</pre>
</div>
</notextile>

<p>These methods should not be used in ordinary views. In Rails 3 unsafe values are automatically escaped:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= @review.title %&gt; &lt;%# fine in Rails 3, escaped if needed %&gt;
</pre>
</div>
</notextile>

<p>To insert something verbatim use the <tt>raw</tt> helper rather than calling <tt>html_safe</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= raw @cms.current_template %&gt; &lt;%# inserts @cms.current_template as is %&gt;
</pre>
</div>
</notextile>

<p>or, equivalently, use <tt>&lt;%==</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%== @cms.current_template %&gt; &lt;%# inserts @cms.current_template as is %&gt;
</pre>
</div>
</notextile>

<p>The <tt>raw</tt> helper calls <tt>html_safe</tt> for you:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def raw(stringish)
  stringish.to_s.html_safe
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/output_safety.rb</tt>.</p></div>
<h4 id="squish">5.2 <tt>squish</tt></h4>
<p>The method <tt>String#squish</tt> strips leading and trailing whitespace, and substitutes runs of whitespace with a single space each:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot; \n  foo\n\r \t bar \n&quot;.squish # =&gt; &quot;foo bar&quot;
</pre>
</div>
</notextile>

<p>There&#8217;s also the destructive version <tt>String#squish!</tt>.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/filters.rb</tt>.</p></div>
<h4 id="truncate">5.3 <tt>truncate</tt></h4>
<p>The method <tt>truncate</tt> returns a copy of its receiver truncated after a given <tt>length</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate(20)
# =&gt; &quot;Oh dear! Oh dear!...&quot;
</pre>
</div>
</notextile>

<p>Ellipsis can be customized with the <tt>:omission</tt> option:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate(20, :omission =&gt; '&amp;hellip;')
# =&gt; &quot;Oh dear! Oh &amp;hellip;&quot;
</pre>
</div>
</notextile>

<p>Note in particular that truncation takes into account the length of the omission string.</p>
<p>Pass a <tt>:separator</tt> to truncate the string at a natural break:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate(18)
# =&gt; &quot;Oh dear! Oh dea...&quot;
&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate(18, :separator =&gt; ' ')
# =&gt; &quot;Oh dear! Oh...&quot;
</pre>
</div>
</notextile>

<p>In the above example &#8220;dear&#8221; gets cut first, but then <tt>:separator</tt> prevents it.</p>
<div class='warning'><p>The option <tt>:separator</tt> can&#8217;t be a regexp.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/filters.rb</tt>.</p></div>
<h4 id="key-based-interpolation">5.4 Key-based Interpolation</h4>
<p>In Ruby 1.9 the <tt>%</tt> string operator supports key-based interpolation, both formatted and unformatted:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;Total is %&lt;total&gt;.02f&quot; % {:total =&gt; 43.1}  # =&gt; Total is 43.10
&quot;I say %{foo}&quot; % {:foo =&gt; &quot;wadus&quot;}          # =&gt; &quot;I say wadus&quot;
&quot;I say %{woo}&quot; % {:foo =&gt; &quot;wadus&quot;}          # =&gt; KeyError
</pre>
</div>
</notextile>

<p>Active Support adds that functionality to <tt>%</tt> in previous versions of Ruby.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/interpolation.rb</tt>.</p></div>
<h4 id="starts_with-and-ends_with">5.5 <tt>starts_with?</tt> and <tt>ends_with?</tt></h4>
<p>Active Support defines 3rd person aliases of <tt>String#start_with?</tt> and <tt>String#end_with?</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;foo&quot;.starts_with?(&quot;f&quot;) # =&gt; true
&quot;foo&quot;.ends_with?(&quot;o&quot;)   # =&gt; true
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/starts_ends_with.rb</tt>.</p></div>
<h4 id="strip_heredoc">5.6 <tt>strip_heredoc</tt></h4>
<p>The method <tt>strip_heredoc</tt> strips indentation in heredocs.</p>
<p>For example in</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
if options[:usage]
  puts &lt;&lt;-USAGE.strip_heredoc
    This command does such and such.

    Supported options are:
      -h         This message
      ...
  USAGE
end
</pre>
</div>
</notextile>

<p>the user would see the usage message aligned against the left margin.</p>
<p>Technically, it looks for the least indented line in the whole string, and removes
that amount of leading whitespace.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/strip.rb</tt>.</p></div>
<h4 id="access">5.7 Access</h4>
<h5 id="at-position">5.7.1 <tt>at(position)</tt></h5>
<p>Returns the character of the string at position <tt>position</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;hello&quot;.at(0)  # =&gt; &quot;h&quot;
&quot;hello&quot;.at(4)  # =&gt; &quot;o&quot;
&quot;hello&quot;.at(-1) # =&gt; &quot;o&quot;
&quot;hello&quot;.at(10) # =&gt; ERROR if &lt; 1.9, nil in 1.9
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/access.rb</tt>.</p></div>
<h5 id="from-position">5.7.2 <tt>from(position)</tt></h5>
<p>Returns the substring of the string starting at position <tt>position</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;hello&quot;.from(0)  # =&gt; &quot;hello&quot;
&quot;hello&quot;.from(2)  # =&gt; &quot;llo&quot;
&quot;hello&quot;.from(-2) # =&gt; &quot;lo&quot;
&quot;hello&quot;.from(10) # =&gt; &quot;&quot; if &lt; 1.9, nil in 1.9
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/access.rb</tt>.</p></div>
<h5 id="to-position">5.7.3 <tt>to(position)</tt></h5>
<p>Returns the substring of the string up to position <tt>position</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;hello&quot;.to(0)  # =&gt; &quot;h&quot;
&quot;hello&quot;.to(2)  # =&gt; &quot;hel&quot;
&quot;hello&quot;.to(-2) # =&gt; &quot;hell&quot;
&quot;hello&quot;.to(10) # =&gt; &quot;hello&quot;
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/access.rb</tt>.</p></div>
<h5 id="first-limit-1">5.7.4 <tt>first(limit = 1)</tt></h5>
<p>The call <tt>str.first(n)</tt> is equivalent to <tt>str.to(n-1)</tt> if <tt>n</tt> &gt; 0, and returns an empty string for <tt>n</tt> == 0.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/access.rb</tt>.</p></div>
<h5 id="last-limit-1">5.7.5 <tt>last(limit = 1)</tt></h5>
<p>The call <tt>str.last(n)</tt> is equivalent to <tt>str.from(-n)</tt> if <tt>n</tt> &gt; 0, and returns an empty string for <tt>n</tt> == 0.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/access.rb</tt>.</p></div>
<h4 id="inflections">5.8 Inflections</h4>
<h5 id="pluralize">5.8.1 <tt>pluralize</tt></h5>
<p>The method <tt>pluralize</tt> returns the plural of its receiver:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;table&quot;.pluralize     # =&gt; &quot;tables&quot;
&quot;ruby&quot;.pluralize      # =&gt; &quot;rubies&quot;
&quot;equipment&quot;.pluralize # =&gt; &quot;equipment&quot;
</pre>
</div>
</notextile>

<p>As the previous example shows, Active Support knows some irregular plurals and uncountable nouns. Built-in rules can be extended in <tt>config/initializers/inflections.rb</tt>. That file is generated by the <tt>rails</tt> command and has instructions in comments.</p>
<p>Active Record uses this method to compute the default table name that corresponds to a model:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# active_record/base.rb
def undecorated_table_name(class_name = base_class.name)
  table_name = class_name.to_s.demodulize.underscore
  table_name = table_name.pluralize if pluralize_table_names
  table_name
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="singularize">5.8.2 <tt>singularize</tt></h5>
<p>The inverse of <tt>pluralize</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;tables&quot;.singularize    # =&gt; &quot;table&quot;
&quot;rubies&quot;.singularize    # =&gt; &quot;ruby&quot;
&quot;equipment&quot;.singularize # =&gt; &quot;equipment&quot;
</pre>
</div>
</notextile>

<p>Associations compute the name of the corresponding default associated class using this method:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# active_record/reflection.rb
def derive_class_name
  class_name = name.to_s.camelize
  class_name = class_name.singularize if collection?
  class_name
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="camelize">5.8.3 <tt>camelize</tt></h5>
<p>The method <tt>camelize</tt> returns its receiver in camel case:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;product&quot;.camelize    # =&gt; &quot;Product&quot;
&quot;admin_user&quot;.camelize # =&gt; &quot;AdminUser&quot;
</pre>
</div>
</notextile>

<p>As a rule of thumb you can think of this method as the one that transforms paths into Ruby class or module names, where slashes separate namespaces:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;backoffice/session&quot;.camelize # =&gt; &quot;Backoffice::Session&quot;
</pre>
</div>
</notextile>

<p>For example, Action Pack uses this method to load the class that provides a certain session store:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# action_controller/metal/session_management.rb
def session_store=(store)
  if store == :active_record_store
    self.session_store = ActiveRecord::SessionStore
  else
    @@session_store = store.is_a?(Symbol) ?
      ActionDispatch::Session.const_get(store.to_s.camelize) :
      store
  end
end
</pre>
</div>
</notextile>

<p><tt>camelize</tt> accepts an optional argument, it can be <tt>:upper</tt> (default), or <tt>:lower</tt>. With the latter the first letter becomes lowercase:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;visual_effect&quot;.camelize(:lower) # =&gt; &quot;visualEffect&quot;
</pre>
</div>
</notextile>

<p>That may be handy to compute method names in a language that follows that convention, for example JavaScript.</p>
<div class='info'><p>As a rule of thumb you can think of <tt>camelize</tt> as the inverse of <tt>underscore</tt>, though there are cases where that does not hold: <tt>&#8220;SSLError&#8221;.underscore.camelize</tt> gives back <tt>&#8220;SslError&#8221;</tt>.</p></div>
<p><tt>camelize</tt> is aliased to <tt>camelcase</tt>.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="underscore">5.8.4 <tt>underscore</tt></h5>
<p>The method <tt>underscore</tt> goes the other way around, from camel case to paths:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;Product&quot;.underscore   # =&gt; &quot;product&quot;
&quot;AdminUser&quot;.underscore # =&gt; &quot;admin_user&quot;
</pre>
</div>
</notextile>

<p>Also converts &#8220;::&#8221; back to &#8220;/&#8221;:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;Backoffice::Session&quot;.underscore # =&gt; &quot;backoffice/session&quot;
</pre>
</div>
</notextile>

<p>and understands strings that start with lowercase:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;visualEffect&quot;.underscore # =&gt; &quot;visual_effect&quot;
</pre>
</div>
</notextile>

<p><tt>underscore</tt> accepts no argument though.</p>
<p>Rails class and module autoloading uses <tt>underscore</tt> to infer the relative path without extension of a file that would define a given missing constant:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# active_support/dependencies.rb
def load_missing_constant(from_mod, const_name)
  ...
  qualified_name = qualified_name_for from_mod, const_name
  path_suffix = qualified_name.underscore
  ...
end
</pre>
</div>
</notextile>

<div class='info'><p>As a rule of thumb you can think of <tt>underscore</tt> as the inverse of <tt>camelize</tt>, though there are cases where that does not hold. For example, <tt>&#8220;SSLError&#8221;.underscore.camelize</tt> gives back <tt>&#8220;SslError&#8221;</tt>.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="titleize">5.8.5 <tt>titleize</tt></h5>
<p>The method <tt>titleize</tt> capitalizes the words in the receiver:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;alice in wonderland&quot;.titleize # =&gt; &quot;Alice In Wonderland&quot;
&quot;fermat's enigma&quot;.titleize     # =&gt; &quot;Fermat's Enigma&quot;
</pre>
</div>
</notextile>

<p><tt>titleize</tt> is aliased to <tt>titlecase</tt>.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="dasherize">5.8.6 <tt>dasherize</tt></h5>
<p>The method <tt>dasherize</tt> replaces the underscores in the receiver with dashes:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;name&quot;.dasherize         # =&gt; &quot;name&quot;
&quot;contact_data&quot;.dasherize # =&gt; &quot;contact-data&quot;
</pre>
</div>
</notextile>

<p>The <span class="caps">XML</span> serializer of models uses this method to dasherize node names:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# active_model/serializers/xml.rb
def reformat_name(name)
  name = name.camelize if camelize?
  dasherize? ? name.dasherize : name
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="demodulize">5.8.7 <tt>demodulize</tt></h5>
<p>Given a string with a qualified constant reference expression, <tt>demodulize</tt> returns the very constant name, that is, the rightmost part of it:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;Product&quot;.demodulize                        # =&gt; &quot;Product&quot;
&quot;Backoffice::UsersController&quot;.demodulize    # =&gt; &quot;UsersController&quot;
&quot;Admin::Hotel::ReservationUtils&quot;.demodulize # =&gt; &quot;ReservationUtils&quot;
</pre>
</div>
</notextile>

<p>Active Record for example uses this method to compute the name of a counter cache column:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# active_record/reflection.rb
def counter_cache_column
  if options[:counter_cache] == true
    &quot;#{active_record.name.demodulize.underscore.pluralize}_count&quot;
  elsif options[:counter_cache]
    options[:counter_cache]
  end
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="parameterize">5.8.8 <tt>parameterize</tt></h5>
<p>The method <tt>parameterize</tt> normalizes its receiver in a way that can be used in pretty URLs.</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;John Smith&quot;.parameterize # =&gt; &quot;john-smith&quot;
&quot;Kurt Gödel&quot;.parameterize # =&gt; &quot;kurt-godel&quot;
</pre>
</div>
</notextile>

<p>In fact, the result string is wrapped in an instance of <tt>ActiveSupport::Multibyte::Chars</tt>.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="tableize">5.8.9 <tt>tableize</tt></h5>
<p>The method <tt>tableize</tt> is <tt>underscore</tt> followed by <tt>pluralize</tt>.</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;Person&quot;.tableize      # =&gt; &quot;people&quot;
&quot;Invoice&quot;.tableize     # =&gt; &quot;invoices&quot;
&quot;InvoiceLine&quot;.tableize # =&gt; &quot;invoice_lines&quot;
</pre>
</div>
</notextile>

<p>As a rule of thumb, <tt>tableize</tt> returns the table name that corresponds to a given model for simple cases. The actual implementation in Active Record is not straight <tt>tableize</tt> indeed, because it also demodulizes the class name and checks a few options that may affect the returned string.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="classify">5.8.10 <tt>classify</tt></h5>
<p>The method <tt>classify</tt> is the inverse of <tt>tableize</tt>. It gives you the class name corresponding to a table name:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;people&quot;.classify        # =&gt; &quot;Person&quot;
&quot;invoices&quot;.classify      # =&gt; &quot;Invoice&quot;
&quot;invoice_lines&quot;.classify # =&gt; &quot;InvoiceLine&quot;
</pre>
</div>
</notextile>

<p>The method understands qualified table names:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;highrise_production.companies&quot;.classify # =&gt; &quot;Company&quot;
</pre>
</div>
</notextile>

<p>Note that <tt>classify</tt> returns a class name as a string. You can get the actual class object invoking <tt>constantize</tt> on it, explained next.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="constantize">5.8.11 <tt>constantize</tt></h5>
<p>The method <tt>constantize</tt> resolves the constant reference expression in its receiver:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;Fixnum&quot;.constantize # =&gt; Fixnum

module M
  X = 1
end
&quot;M::X&quot;.constantize # =&gt; 1
</pre>
</div>
</notextile>

<p>If the string evaluates to no known constant, or its content is not even a valid constant name, <tt>constantize</tt> raises <tt>NameError</tt>.</p>
<p>Constant name resolution by <tt>constantize</tt> starts always at the top-level <tt>Object</tt> even if there is no leading &#8220;::&#8221;.</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
X = :in_Object
module M
  X = :in_M

  X                 # =&gt; :in_M
  &quot;::X&quot;.constantize # =&gt; :in_Object
  &quot;X&quot;.constantize   # =&gt; :in_Object (!)
end
</pre>
</div>
</notextile>

<p>So, it is in general not equivalent to what Ruby would do in the same spot, had a real constant be evaluated.</p>
<p>Mailer test cases obtain the mailer being tested from the name of the test class using <tt>constantize</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# action_mailer/test_case.rb
def determine_default_mailer(name)
  name.sub(/Test$/, '').constantize
rescue NameError =&gt; e
  raise NonInferrableMailerError.new(name)
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="humanize">5.8.12 <tt>humanize</tt></h5>
<p>The method <tt>humanize</tt> gives you a sensible name for display out of an attribute name. To do so it replaces underscores with spaces, removes any &#8220;_id&#8221; suffix, and capitalizes the first word:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;name&quot;.humanize           # =&gt; &quot;Name&quot;
&quot;author_id&quot;.humanize      # =&gt; &quot;Author&quot;
&quot;comments_count&quot;.humanize # =&gt; &quot;Comments count&quot;
</pre>
</div>
</notextile>

<p>The helper method <tt>full_messages</tt> uses <tt>humanize</tt> as a fallback to include attribute names:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def full_messages
  full_messages = []

  each do |attribute, messages|
    ...
    attr_name = attribute.to_s.gsub('.', '_').humanize
    attr_name = @base.class.human_attribute_name(attribute, :default =&gt; attr_name)
    ...
  end

  full_messages
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h5 id="foreign_key">5.8.13 <tt>foreign_key</tt></h5>
<p>The method <tt>foreign_key</tt> gives a foreign key column name from a class name. To do so it demodulizes, underscores, and adds &#8220;_id&#8221;:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;User&quot;.foreign_key           # =&gt; &quot;user_id&quot;
&quot;InvoiceLine&quot;.foreign_key    # =&gt; &quot;invoice_line_id&quot;
&quot;Admin::Session&quot;.foreign_key # =&gt; &quot;session_id&quot;
</pre>
</div>
</notextile>

<p>Pass a false argument if you do not want the underscore in &#8220;_id&#8221;:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;User&quot;.foreign_key(false) # =&gt; &quot;userid&quot;
</pre>
</div>
</notextile>

<p>Associations use this method to infer foreign keys, for example <tt>has_one</tt> and <tt>has_many</tt> do this:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# active_record/associations.rb
foreign_key = options[:foreign_key] || reflection.active_record.name.foreign_key
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/string/inflections.rb</tt>.</p></div>
<h4 id="string-conversions">5.9 Conversions</h4>
<h5 id="ord">5.9.1 <tt>ord</tt></h5>
<p>Ruby 1.9 defines <tt>ord</tt> to be the codepoint of the first character of the receiver. Active Support backports <tt>ord</tt> for single-byte encondings like <span class="caps">ASCII</span> or <span class="caps">ISO</span>-8859-1 in Ruby 1.8:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;a&quot;.ord # =&gt; 97
&quot;à&quot;.ord # =&gt; 224, in ISO-8859-1
</pre>
</div>
</notextile>

<p>In Ruby 1.8 <tt>ord</tt> doesn&#8217;t work in general in UTF8 strings, use the multibyte support in Active Support for that:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;a&quot;.mb_chars.ord # =&gt; 97
&quot;à&quot;.mb_chars.ord # =&gt; 224, in UTF8
</pre>
</div>
</notextile>

<p>Note that the 224 is different in both examples. In <span class="caps">ISO</span>-8859-1 &#8220;à&#8221; is represented as a single byte, 224. Its single-character representattion in UTF8 has two bytes, namely 195 and 160, but its Unicode codepoint is 224. If we call <tt>ord</tt> on the UTF8 string &#8220;à&#8221; the return value will be 195 in Ruby 1.8. That is not an error, because UTF8 is unsupported, the call itself would be bogus.</p>
<div class='info'><p><tt>ord</tt> is equivalent to <tt>getbyte(0)</tt>.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/conversions.rb</tt>.</p></div>
<h5 id="getbyte">5.9.2 <tt>getbyte</tt></h5>
<p>Active Support backports <tt>getbyte</tt> from Ruby 1.9:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;foo&quot;.getbyte(0)  # =&gt; 102, same as &quot;foo&quot;.ord
&quot;foo&quot;.getbyte(1)  # =&gt; 111
&quot;foo&quot;.getbyte(9)  # =&gt; nil
&quot;foo&quot;.getbyte(-1) # =&gt; 111
</pre>
</div>
</notextile>

<div class='info'><p><tt>getbyte</tt> is equivalent to <tt>[]</tt>.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/conversions.rb</tt>.</p></div>
<h5 id="to_date-to_time-to_datetime">5.9.3 <tt>to_date</tt>, <tt>to_time</tt>, <tt>to_datetime</tt></h5>
<p>The methods <tt>to_date</tt>, <tt>to_time</tt>, and <tt>to_datetime</tt> are basically convenience wrappers around <tt>Date._parse</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;2010-07-27&quot;.to_date              # =&gt; Tue, 27 Jul 2010
&quot;2010-07-27 23:37:00&quot;.to_time     # =&gt; Tue Jul 27 23:37:00 UTC 2010
&quot;2010-07-27 23:37:00&quot;.to_datetime # =&gt; Tue, 27 Jul 2010 23:37:00 +0000
</pre>
</div>
</notextile>

<p><tt>to_time</tt> receives an optional argument <tt>:utc</tt> or <tt>:local</tt>, to indicate which time zone you want the time in:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&quot;2010-07-27 23:42:00&quot;.to_time(:utc)   # =&gt; Tue Jul 27 23:42:00 UTC 2010
&quot;2010-07-27 23:42:00&quot;.to_time(:local) # =&gt; Tue Jul 27 23:42:00 +0200 2010
</pre>
</div>
</notextile>

<p>Default is <tt>:utc</tt>.</p>
<p>Please refer to the documentation of <tt>Date._parse</tt> for further details.</p>
<div class='info'><p>The three of them return <tt>nil</tt> for blank receivers.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/string/conversions.rb</tt>.</p></div>
<h3 id="extensions-to-numeric">6 Extensions to <tt>Numeric</tt></h3>
<h4 id="bytes">6.1 Bytes</h4>
<p>All numbers respond to these methods:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
bytes
kilobytes
megabytes
gigabytes
terabytes
petabytes
exabytes
</pre>
</div>
</notextile>

<p>They return the corresponding amount of bytes, using a conversion factor of 1024:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
2.kilobytes   # =&gt; 2048
3.megabytes   # =&gt; 3145728
3.5.gigabytes # =&gt; 3758096384
-4.exabytes   # =&gt; -4611686018427387904
</pre>
</div>
</notextile>

<p>Singular forms are aliased so you are able to say:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
1.megabyte # =&gt; 1048576
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/numeric/bytes.rb</tt>.</p></div>
<h3 id="extensions-to-integer">7 Extensions to <tt>Integer</tt></h3>
<h4 id="multiple_of">7.1 <tt>multiple_of?</tt></h4>
<p>The method <tt>multiple_of?</tt> tests whether an integer is multiple of the argument:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
2.multiple_of?(1) # =&gt; true
1.multiple_of?(2) # =&gt; false
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/integer/multiple.rb</tt>.</p></div>
<h4 id="ordinalize">7.2 <tt>ordinalize</tt></h4>
<p>The method <tt>ordinalize</tt> returns the ordinal string corresponding to the receiver integer:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
1.ordinalize    # =&gt; &quot;1st&quot;
2.ordinalize    # =&gt; &quot;2nd&quot;
53.ordinalize   # =&gt; &quot;53rd&quot;
2009.ordinalize # =&gt; &quot;2009th&quot;
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/integer/inflections.rb</tt>.</p></div>
<h3 id="extensions-to-float">8 Extensions to <tt>Float</tt></h3>
<h4 id="round">8.1 <tt>round</tt></h4>
<p>The built-in method <tt>Float#round</tt> rounds a float to the nearest integer. Active Support adds an optional parameter to let you specify a precision:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Math::E.round(4) # =&gt; 2.7183
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/float/rounding.rb</tt>.</p></div>
<h3 id="extensions-to-bigdecimal">9 Extensions to <tt>BigDecimal</tt></h3>
<p>&#8230;</p>
<h3 id="extensions-to-enumerable">10 Extensions to <tt>Enumerable</tt></h3>
<h4 id="group_by">10.1 <tt>group_by</tt></h4>
<p>Active Support redefines <tt>group_by</tt> in Ruby 1.8.7 so that it returns an ordered hash as in 1.9:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
entries_by_surname_initial = address_book.group_by do |entry|
  entry.surname.at(0).upcase
end
</pre>
</div>
</notextile>

<p>Distinct block return values are added to the hash as they come, so that&#8217;s the resulting order.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/enumerable.rb</tt>.</p></div>
<h4 id="sum">10.2 <tt>sum</tt></h4>
<p>The method <tt>sum</tt> adds the elements of an enumerable:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[1, 2, 3].sum # =&gt; 6
(1..100).sum  # =&gt; 5050
</pre>
</div>
</notextile>

<p>Addition only assumes the elements respond to <tt>+</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[[1, 2], [2, 3], [3, 4]].sum    # =&gt; [1, 2, 2, 3, 3, 4]
%w(foo bar baz).sum             # =&gt; &quot;foobarbaz&quot;
{:a =&gt; 1, :b =&gt; 2, :c =&gt; 3}.sum # =&gt; [:b, 2, :c, 3, :a, 1]
</pre>
</div>
</notextile>

<p>The sum of an empty collection is zero by default, but this is customizable:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[].sum    # =&gt; 0
[].sum(1) # =&gt; 1
</pre>
</div>
</notextile>

<p>If a block is given, <tt>sum</tt> becomes an iterator that yields the elements of the collection and sums the returned values:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
(1..5).sum {|n| n * 2 } # =&gt; 30
[2, 4, 6, 8, 10].sum    # =&gt; 30
</pre>
</div>
</notextile>

<p>The sum of an empty receiver can be customized in this form as well:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[].sum(1) {|n| n**3} # =&gt; 1
</pre>
</div>
</notextile>

<p>The method <tt>ActiveRecord::Observer#observed_subclasses</tt> for example is implemented this way:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def observed_subclasses
  observed_classes.sum([]) { |klass| klass.send(:subclasses) }
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/enumerable.rb</tt>.</p></div>
<h4 id="each_with_object">10.3 <tt>each_with_object</tt></h4>
<p>The <tt>inject</tt> method offers iteration with an accumulator:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[2, 3, 4].inject(1) {|product, i| product*i } # =&gt; 24
</pre>
</div>
</notextile>

<p>The block is expected to return the value for the accumulator in the next iteration, and this makes building mutable objects a bit cumbersome:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[1, 2].inject({}) {|h, i| h[i] = i**2; h} # =&gt; {1 =&gt; 1, 2 =&gt; 4}
</pre>
</div>
</notextile>

<p>See that spurious &#8220;<tt>; h</tt>&#8221;?</p>
<p>Active Support backports <tt>each_with_object</tt> from Ruby 1.9, which addresses that use case. It iterates over the collection, passes the accumulator, and returns the accumulator when done. You normally modify the accumulator in place. The example above would be written this way:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[1, 2].each_with_object({}) {|i, h| h[i] = i**2} # =&gt; {1 =&gt; 1, 2 =&gt; 4}
</pre>
</div>
</notextile>

<div class='warning'><p>Note that the item of the collection and the accumulator come in different order in <tt>inject</tt> and <tt>each_with_object</tt>.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/enumerable.rb</tt>.</p></div>
<h4 id="index_by">10.4 <tt>index_by</tt></h4>
<p>The method <tt>index_by</tt> generates a hash with the elements of an enumerable indexed by some key.</p>
<p>It iterates through the collection and passes each element to a block. The element will be keyed by the value returned by the block:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
invoices.index_by(&amp;:number)
# =&gt; {'2009-032' =&gt; &lt;Invoice ...&gt;, '2009-008' =&gt; &lt;Invoice ...&gt;, ...}
</pre>
</div>
</notextile>

<div class='warning'><p>Keys should normally be unique. If the block returns the same value for different elements no collection is built for that key. The last item will win.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/enumerable.rb</tt>.</p></div>
<h4 id="many">10.5 <tt>many?</tt></h4>
<p>The method <tt>many?</tt> is shorthand for <tt>collection.size > 1</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;% if pages.many? %&gt;
  &lt;%= pagination_links %&gt;
&lt;% end %&gt;
</pre>
</div>
</notextile>

<p>If an optional block is given, <tt>many?</tt> only takes into account those elements that return true:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@see_more = videos.many? {|video| video.category == params[:category]}
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/enumerable.rb</tt>.</p></div>
<h4 id="exclude">10.6 <tt>exclude?</tt></h4>
<p>The predicate <tt>exclude?</tt> tests whether a given object does <strong>not</strong> belong to the collection. It is the negation of the built-in <tt>include?</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
to_visit &lt;&lt; node if visited.exclude?(node)
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/enumerable.rb</tt>.</p></div>
<h3 id="extensions-to-array">11 Extensions to <tt>Array</tt></h3>
<h4 id="accessing">11.1 Accessing</h4>
<p>Active Support augments the <span class="caps">API</span> of arrays to ease certain ways of accessing them. For example, <tt>to</tt> returns the subarray of elements up to the one at the passed index:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
%w(a b c d).to(2) # =&gt; %w(a b c)
[].to(7)          # =&gt; []
</pre>
</div>
</notextile>

<p>Similarly, <tt>from</tt> returns the tail from the element at the passed index on:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
%w(a b c d).from(2)  # =&gt; %w(c d)
%w(a b c d).from(10) # =&gt; nil
[].from(0)           # =&gt; []
</pre>
</div>
</notextile>

<p>The methods <tt>second</tt>, <tt>third</tt>, <tt>fourth</tt>, and <tt>fifth</tt> return the corresponding element (<tt>first</tt> is built-in). Thanks to social wisdom and positive constructiveness all around, <tt>forty_two</tt> is also available.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/array/access.rb</tt>.</p></div>
<h4 id="random-access">11.2 Random Access</h4>
<p>Active Support backports <tt>sample</tt> from Ruby 1.9:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
shape_type = [Circle, Square, Triangle].sample
# =&gt; Square, for example

shape_types = [Circle, Square, Triangle].sample(2)
# =&gt; [Triangle, Circle], for example
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/array/random_access.rb</tt>.</p></div>
<h4 id="options-extraction">11.3 Options Extraction</h4>
<p>When the last argument in a method call is a hash, except perhaps for a <tt>&block</tt> argument, Ruby allows you to omit the brackets:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
User.exists?(:email =&gt; params[:email])
</pre>
</div>
</notextile>

<p>That syntactic sugar is used a lot in Rails to avoid positional arguments where there would be too many, offering instead interfaces that emulate named parameters. In particular it is very idiomatic to use a trailing hash for options.</p>
<p>If a method expects a variable number of arguments and uses <tt>*</tt> in its declaration, however, such an options hash ends up being an item of the array of arguments, where kind of loses its role.</p>
<p>In those cases, you may give an options hash a distinguished treatment with <tt>extract_options!</tt>. That method checks the type of the last item of an array. If it is a hash it pops it and returns it, otherwise returns an empty hash.</p>
<p>Let&#8217;s see for example the definition of the <tt>caches_action</tt> controller macro:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def caches_action(*actions)
  return unless cache_configured?
  options = actions.extract_options!
  ...
end
</pre>
</div>
</notextile>

<p>This method receives an arbitrary number of action names, and an optional hash of options as last argument. With the call to <tt>extract_options!</tt> you obtain the options hash and remove it from <tt>actions</tt> in a simple and explicit way.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/array/extract_options.rb</tt>.</p></div>
<h4 id="array-conversions">11.4 Conversions</h4>
<h5 id="to_sentence">11.4.1 <tt>to_sentence</tt></h5>
<p>The method <tt>to_sentence</tt> turns an array into a string containing a sentence that enumerates its items:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
%w().to_sentence                # =&gt; &quot;&quot;
%w(Earth).to_sentence           # =&gt; &quot;Earth&quot;
%w(Earth Wind).to_sentence      # =&gt; &quot;Earth and Wind&quot;
%w(Earth Wind Fire).to_sentence # =&gt; &quot;Earth, Wind, and Fire&quot;
</pre>
</div>
</notextile>

<p>This method accepts three options:</p>
<ul>
	<li><tt>:two_words_connector</tt>: What is used for arrays of length 2. Default is &quot; and &quot;.</li>
	<li><tt>:words_connector</tt>: What is used to join the elements of arrays with 3 or more elements, except for the last two. Default is &quot;, &quot;.</li>
	<li><tt>:last_word_connector</tt>: What is used to join the last items of an array with 3 or more elements. Default is &quot;, and &quot;.</li>
</ul>
<p>The defaults for these options can be localised, their keys are:</p>
<table>
	<tr>
		<th>Option                      </th>
		<th>I18n key                                 </th>
	</tr>
	<tr>
		<td> <tt>:two_words_connector</tt> </td>
		<td> <tt>support.array.two_words_connector</tt> </td>
	</tr>
	<tr>
		<td> <tt>:words_connector</tt>     </td>
		<td> <tt>support.array.words_connector</tt>     </td>
	</tr>
	<tr>
		<td> <tt>:last_word_connector</tt> </td>
		<td> <tt>support.array.last_word_connector</tt> </td>
	</tr>
</table>
<p>Options <tt>:connector</tt> and <tt>:skip_last_comma</tt> are deprecated.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/array/conversions.rb</tt>.</p></div>
<h5 id="to_formatted_s">11.4.2 <tt>to_formatted_s</tt></h5>
<p>The method <tt>to_formatted_s</tt> acts like <tt>to_s</tt> by default.</p>
<p>If the array contains items that respond to <tt>id</tt>, however, it may be passed the symbol <tt>:db</tt> as argument. That&#8217;s typically used with collections of ARs, though technically any object in Ruby 1.8 responds to <tt>id</tt> indeed. Returned strings are:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[].to_formatted_s(:db)            # =&gt; &quot;null&quot;
[user].to_formatted_s(:db)        # =&gt; &quot;8456&quot;
invoice.lines.to_formatted_s(:db) # =&gt; &quot;23,567,556,12&quot;
</pre>
</div>
</notextile>

<p>Integers in the example above are supposed to come from the respective calls to <tt>id</tt>.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/array/conversions.rb</tt>.</p></div>
<h5 id="to_xml">11.4.3 <tt>to_xml</tt></h5>
<p>The method <tt>to_xml</tt> returns a string containing an <span class="caps">XML</span> representation of its receiver:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Contributor.all(:limit =&gt; 2, :order =&gt; 'rank ASC').to_xml
# =&gt;
# &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
# &lt;contributors type=&quot;array&quot;&gt;
#   &lt;contributor&gt;
#     &lt;id type=&quot;integer&quot;&gt;4356&lt;/id&gt;
#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;
#     &lt;rank type=&quot;integer&quot;&gt;1&lt;/rank&gt;
#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
#   &lt;/contributor&gt;
#   &lt;contributor&gt;
#     &lt;id type=&quot;integer&quot;&gt;4404&lt;/id&gt;
#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
#     &lt;rank type=&quot;integer&quot;&gt;2&lt;/rank&gt;
#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
#   &lt;/contributor&gt;
# &lt;/contributors&gt;
</pre>
</div>
</notextile>

<p>To do so it sends <tt>to_xml</tt> to every item in turn, and collects the results under a root node. All items must respond to <tt>to_xml</tt>, an exception is raised otherwise.</p>
<p>By default, the name of the root element is the underscorized and dasherized plural of the name of the class of the first item, provided the rest of elements belong to that type (checked with <tt>is_a?</tt>) and they are not hashes. In the example above that&#8217;s &#8220;contributors&#8221;.</p>
<p>If there&#8217;s any element that does not belong to the type of the first one the root node becomes &#8220;records&#8221;:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[Contributor.first, Commit.first].to_xml
# =&gt;
# &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
# &lt;records type=&quot;array&quot;&gt;
#   &lt;record&gt;
#     &lt;id type=&quot;integer&quot;&gt;4583&lt;/id&gt;
#     &lt;name&gt;Aaron Batalion&lt;/name&gt;
#     &lt;rank type=&quot;integer&quot;&gt;53&lt;/rank&gt;
#     &lt;url-id&gt;aaron-batalion&lt;/url-id&gt;
#   &lt;/record&gt;
#   &lt;record&gt;
#     &lt;author&gt;Joshua Peek&lt;/author&gt;
#     &lt;authored-timestamp type=&quot;datetime&quot;&gt;2009-09-02T16:44:36Z&lt;/authored-timestamp&gt;
#     &lt;branch&gt;origin/master&lt;/branch&gt;
#     &lt;committed-timestamp type=&quot;datetime&quot;&gt;2009-09-02T16:44:36Z&lt;/committed-timestamp&gt;
#     &lt;committer&gt;Joshua Peek&lt;/committer&gt;
#     &lt;git-show nil=&quot;true&quot;&gt;&lt;/git-show&gt;
#     &lt;id type=&quot;integer&quot;&gt;190316&lt;/id&gt;
#     &lt;imported-from-svn type=&quot;boolean&quot;&gt;false&lt;/imported-from-svn&gt;
#     &lt;message&gt;Kill AMo observing wrap_with_notifications since ARes was only using it&lt;/message&gt;
#     &lt;sha1&gt;723a47bfb3708f968821bc969a9a3fc873a3ed58&lt;/sha1&gt;
#   &lt;/record&gt;
# &lt;/records&gt;
</pre>
</div>
</notextile>

<p>If the receiver is an array of hashes the root element is by default also &#8220;records&#8221;:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[{:a =&gt; 1, :b =&gt; 2}, {:c =&gt; 3}].to_xml
# =&gt;
# &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
# &lt;records type=&quot;array&quot;&gt;
#   &lt;record&gt;
#     &lt;b type=&quot;integer&quot;&gt;2&lt;/b&gt;
#     &lt;a type=&quot;integer&quot;&gt;1&lt;/a&gt;
#   &lt;/record&gt;
#   &lt;record&gt;
#     &lt;c type=&quot;integer&quot;&gt;3&lt;/c&gt;
#   &lt;/record&gt;
# &lt;/records&gt;
</pre>
</div>
</notextile>

<div class='warning'><p>If the collection is empty the root element is by default &#8220;nil-classes&#8221;. That&#8217;s a gotcha, for example the root element of the list of contributors above would not be &#8220;contributors&#8221; if the collection was empty, but &#8220;nil-classes&#8221;. You may use the <tt>:root</tt> option to ensure a consistent root element.</p></div>
<p>The name of children nodes is by default the name of the root node singularized. In the examples above we&#8217;ve seen &#8220;contributor&#8221; and &#8220;record&#8221;. The option <tt>:children</tt> allows you to set these node names.</p>
<p>The default <span class="caps">XML</span> builder is a fresh instance of <tt>Builder::XmlMarkup</tt>. You can configure your own builder via the <tt>:builder</tt> option. The method also accepts options like <tt>:dasherize</tt> and friends, they are forwarded to the builder:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Contributor.all(:limit =&gt; 2, :order =&gt; 'rank ASC').to_xml(:skip_types =&gt; true)
# =&gt;
# &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
# &lt;contributors&gt;
#   &lt;contributor&gt;
#     &lt;id&gt;4356&lt;/id&gt;
#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;
#     &lt;rank&gt;1&lt;/rank&gt;
#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
#   &lt;/contributor&gt;
#   &lt;contributor&gt;
#     &lt;id&gt;4404&lt;/id&gt;
#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
#     &lt;rank&gt;2&lt;/rank&gt;
#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
#   &lt;/contributor&gt;
# &lt;/contributors&gt;
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/array/conversions.rb</tt>.</p></div>
<h4 id="wrapping">11.5 Wrapping</h4>
<p>The method <tt>Array.wrap</tt> wraps its argument in an array unless it is already an array (or array-like).</p>
<p>Specifically:</p>
<ul>
	<li>If the argument is <tt>nil</tt> an empty list is returned.</li>
	<li>Otherwise, if the argument responds to <tt>to_ary</tt> it is invoked, and its result returned.</li>
	<li>Otherwise, returns an array with the argument as its single element.</li>
</ul>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Array.wrap(nil)       # =&gt; []
Array.wrap([1, 2, 3]) # =&gt; [1, 2, 3]
Array.wrap(0)         # =&gt; [0]
</pre>
</div>
</notextile>

<p>This method is similar in purpose to <tt>Kernel#Array</tt>, but there are some differences:</p>
<ul>
	<li>If the argument responds to <tt>to_ary</tt> the method is invoked. <tt>Kernel#Array</tt> moves on to try <tt>to_a</tt> if the returned value is <tt>nil</tt>, but <tt>Arraw.wrap</tt> returns such a <tt>nil</tt> right away.</li>
	<li>If the returned value from <tt>to_ary</tt> is neither <tt>nil</tt> nor an <tt>Array</tt> object, <tt>Kernel#Array</tt> raises an exception, while <tt>Array.wrap</tt> does not, it just returns the value.</li>
	<li>It does not call <tt>to_a</tt> on the argument, though special-cases <tt>nil</tt> to return an empty array.</li>
</ul>
<p>The last point is particularly worth comparing for some enumerables:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Array.wrap(:foo =&gt; :bar) # =&gt; [{:foo =&gt; :bar}]
Array(:foo =&gt; :bar)      # =&gt; [[:foo, :bar]]

Array.wrap(&quot;foo\nbar&quot;)   # =&gt; [&quot;foo\nbar&quot;]
Array(&quot;foo\nbar&quot;)        # =&gt; [&quot;foo\n&quot;, &quot;bar&quot;], in Ruby 1.8
</pre>
</div>
</notextile>

<p>There&#8217;s also a related idiom that uses the splat operator:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[*object]
</pre>
</div>
</notextile>

<p>which in Ruby 1.8 returns <tt>[nil]</tt> for <tt>nil</tt>, and calls to <tt>Array(object)</tt> otherwise. (Please if you know the exact behavior in 1.9 contact fxn.)</p>
<p>Thus, in this case the behavior is different for <tt>nil</tt>, and the differences with <tt>Kernel#Array</tt> explained above apply to the rest of <tt>object</tt>s.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/array/wrap.rb</tt>.</p></div>
<h4 id="grouping">11.6 Grouping</h4>
<h5 id="in_groups_of-number-fill_with-nil">11.6.1 <tt>in_groups_of(number, fill_with = nil)</tt></h5>
<p>The method <tt>in_groups_of</tt> splits an array into consecutive groups of a certain size. It returns an array with the groups:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[1, 2, 3].in_groups_of(2) # =&gt; [[1, 2], [3, nil]]
</pre>
</div>
</notextile>

<p>or yields them in turn if a block is passed:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&lt;% sample.in_groups_of(3) do |a, b, c| %&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;%=h a %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%=h b %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%=h c %&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;
</pre>
</div>
</notextile>

<p>The first example shows <tt>in_groups_of</tt> fills the last group with as many <tt>nil</tt> elements as needed to have the requested size. You can change this padding value using the second optional argument:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[1, 2, 3].in_groups_of(2, 0) # =&gt; [[1, 2], [3, 0]]
</pre>
</div>
</notextile>

<p>And you can tell the method not to fill the last group passing <tt>false</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[1, 2, 3].in_groups_of(2, false) # =&gt; [[1, 2], [3]]
</pre>
</div>
</notextile>

<p>As a consequence <tt>false</tt> can&#8217;t be a used as a padding value.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/array/grouping.rb</tt>.</p></div>
<h5 id="in_groups-number-fill_with-nil">11.6.2 <tt>in_groups(number, fill_with = nil)</tt></h5>
<p>The method <tt>in_groups</tt> splits an array into a certain number of groups. The method returns and array with the groups:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
%w(1 2 3 4 5 6 7).in_groups(3)
# =&gt; [[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;], [&quot;4&quot;, &quot;5&quot;, nil], [&quot;6&quot;, &quot;7&quot;, nil]]
</pre>
</div>
</notextile>

<p>or yields them in turn if a block is passed:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
%w(1 2 3 4 5 6 7).in_groups(3) {|group| p group}
[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;]
[&quot;4&quot;, &quot;5&quot;, nil]
[&quot;6&quot;, &quot;7&quot;, nil]
</pre>
</div>
</notextile>

<p>The examples above show that <tt>in_groups</tt> fills some groups with a trailing <tt>nil</tt> element as needed. A group can get at most one of these extra elements, the rightmost one if any. And the groups that have them are always the last ones.</p>
<p>You can change this padding value using the second optional argument:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
%w(1 2 3 4 5 6 7).in_groups(3, &quot;0&quot;)
# =&gt; [[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;], [&quot;4&quot;, &quot;5&quot;, &quot;0&quot;], [&quot;6&quot;, &quot;7&quot;, &quot;0&quot;]]
</pre>
</div>
</notextile>

<p>And you can tell the method not to fill the smaller groups passing <tt>false</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
%w(1 2 3 4 5 6 7).in_groups(3, false)
# =&gt; [[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;], [&quot;4&quot;, &quot;5&quot;], [&quot;6&quot;, &quot;7&quot;]]
</pre>
</div>
</notextile>

<p>As a consequence <tt>false</tt> can&#8217;t be a used as a padding value.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/array/grouping.rb</tt>.</p></div>
<h5 id="split-value-nil">11.6.3 <tt>split(value = nil)</tt></h5>
<p>The method <tt>split</tt> divides an array by a separator and returns the resulting chunks.</p>
<p>If a block is passed the separators are those elements of the array for which the block returns true:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
(-5..5).to_a.split { |i| i.multiple_of?(4) }
# =&gt; [[-5], [-3, -2, -1], [1, 2, 3], [5]]
</pre>
</div>
</notextile>

<p>Otherwise, the value received as argument, which defaults to <tt>nil</tt>, is the separator:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
[0, 1, -5, 1, 1, &quot;foo&quot;, &quot;bar&quot;].split(1)
# =&gt; [[0], [-5], [], [&quot;foo&quot;, &quot;bar&quot;]]
</pre>
</div>
</notextile>

<div class='info'><p>Observe in the previous example that consecutive separators result in empty arrays.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/array/grouping.rb</tt>.</p></div>
<h3 id="extensions-to-hash">12 Extensions to <tt>Hash</tt></h3>
<h4 id="hash-conversions">12.1 Conversions</h4>
<h5 id="hash-to-xml">12.1.1 <tt>to_xml</tt></h5>
<p>The method <tt>to_xml</tt> returns a string containing an <span class="caps">XML</span> representation of its receiver:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{&quot;foo&quot; =&gt; 1, &quot;bar&quot; =&gt; 2}.to_xml
# =&gt;
# &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
# &lt;hash&gt;
#   &lt;foo type=&quot;integer&quot;&gt;1&lt;/foo&gt;
#   &lt;bar type=&quot;integer&quot;&gt;2&lt;/bar&gt;
# &lt;/hash&gt;
</pre>
</div>
</notextile>

<p>To do so, the method loops over the pairs and builds nodes that depend on the <em>values</em>. Given a pair <tt>key</tt>, <tt>value</tt>:</p>
<ul>
	<li>If <tt>value</tt> is a hash there&#8217;s a recursive call with <tt>key</tt> as <tt>:root</tt>.</li>
</ul>
<ul>
	<li>If <tt>value</tt> is an array there&#8217;s a recursive call with <tt>key</tt> as <tt>:root</tt>, and <tt>key</tt> singularized as <tt>:children</tt>.</li>
</ul>
<ul>
	<li>If <tt>value</tt> is a callable object it must expect one or two arguments. Depending on the arity, the callable is invoked with the <tt>options</tt> hash as first argument with <tt>key</tt> as <tt>:root</tt>, and <tt>key</tt> singularized as second argument. Its return value becomes a new node.</li>
</ul>
<ul>
	<li>If <tt>value</tt> responds to <tt>to_xml</tt> the method is invoked with <tt>key</tt> as <tt>:root</tt>.</li>
</ul>
<ul>
	<li>Otherwise, a node with <tt>key</tt> as tag is created with a string representation of <tt>value</tt> as text node. If <tt>value</tt> is <tt>nil</tt> an attribute &#8220;nil&#8221; set to &#8220;true&#8221; is added. Unless the option <tt>:skip_types</tt> exists and is true, an attribute &#8220;type&#8221; is added as well according to the following mapping:</li>
</ul>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
XML_TYPE_NAMES = {
  &quot;Symbol&quot;     =&gt; &quot;symbol&quot;,
  &quot;Fixnum&quot;     =&gt; &quot;integer&quot;,
  &quot;Bignum&quot;     =&gt; &quot;integer&quot;,
  &quot;BigDecimal&quot; =&gt; &quot;decimal&quot;,
  &quot;Float&quot;      =&gt; &quot;float&quot;,
  &quot;TrueClass&quot;  =&gt; &quot;boolean&quot;,
  &quot;FalseClass&quot; =&gt; &quot;boolean&quot;,
  &quot;Date&quot;       =&gt; &quot;date&quot;,
  &quot;DateTime&quot;   =&gt; &quot;datetime&quot;,
  &quot;Time&quot;       =&gt; &quot;datetime&quot;
}
</pre>
</div>
</notextile>

<p>By default the root node is &#8220;hash&#8221;, but that&#8217;s configurable via the <tt>:root</tt> option.</p>
<p>The default <span class="caps">XML</span> builder is a fresh instance of <tt>Builder::XmlMarkup</tt>. You can configure your own builder with the <tt>:builder</tt> option. The method also accepts options like <tt>:dasherize</tt> and friends, they are forwarded to the builder.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/hash/conversions.rb</tt>.</p></div>
<h4 id="merging">12.2 Merging</h4>
<p>Ruby has a built-in method <tt>Hash#merge</tt> that merges two hashes:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{:a =&gt; 1, :b =&gt; 1}.merge(:a =&gt; 0, :c =&gt; 2)
# =&gt; {:a =&gt; 0, :b =&gt; 1, :c =&gt; 2}
</pre>
</div>
</notextile>

<p>Active Support defines a few more ways of merging hashes that may be convenient.</p>
<h5 id="reverse_merge-and-reverse_merge">12.2.1 <tt>reverse_merge</tt> and <tt>reverse_merge!</tt></h5>
<p>In case of collision the key in the hash of the argument wins in <tt>merge</tt>. You can support option hashes with default values in a compact way with this idiom:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
options = {:length =&gt; 30, :omission =&gt; &quot;...&quot;}.merge(options)
</pre>
</div>
</notextile>

<p>Active Support defines <tt>reverse_merge</tt> in case you prefer this alternative notation:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
options = options.reverse_merge(:length =&gt; 30, :omission =&gt; &quot;...&quot;)
</pre>
</div>
</notextile>

<p>And a bang version <tt>reverse_merge!</tt> that performs the merge in place:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
options.reverse_merge!(:length =&gt; 30, :omission =&gt; &quot;...&quot;)
</pre>
</div>
</notextile>

<div class='warning'><p>Take into account that <tt>reverse_merge!</tt> may change the hash in the caller, which may or may not be a good idea.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/hash/reverse_merge.rb</tt>.</p></div>
<h5 id="reverse_update">12.2.2 <tt>reverse_update</tt></h5>
<p>The method <tt>reverse_update</tt> is an alias for <tt>reverse_merge!</tt>, explained above.</p>
<div class='warning'><p>Note that <tt>reverse_update</tt> has no bang.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/hash/reverse_merge.rb</tt>.</p></div>
<h5 id="deep_merge-and-deep_merge">12.2.3 <tt>deep_merge</tt> and <tt>deep_merge!</tt></h5>
<p>As you can see in the previous example if a key is found in both hashes the value in the one in the argument wins.</p>
<p>Active Support defines <tt>Hash#deep_merge</tt>. In a deep merge, if a key is found in both hashes and their values are hashes in turn, then their <em>merge</em> becomes the value in the resulting hash:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{:a =&gt; {:b =&gt; 1}}.deep_merge(:a =&gt; {:c =&gt; 2})
# =&gt; {:a =&gt; {:b =&gt; 1, :c =&gt; 2}}
</pre>
</div>
</notextile>

<p>The method <tt>deep_merge!</tt> performs a deep merge in place.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/hash/deep_merge.rb</tt>.</p></div>
<h4 id="diffing">12.3 Diffing</h4>
<p>The method <tt>diff</tt> returns a hash that represents a diff of the receiver and the argument with the following logic:</p>
<ul>
	<li>Pairs <tt>key</tt>, <tt>value</tt> that exist in both hashes do not belong to the diff hash.</li>
</ul>
<ul>
	<li>If both hashes have <tt>key</tt>, but with different values, the pair in the receiver wins.</li>
</ul>
<ul>
	<li>The rest is just merged.</li>
</ul>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{:a =&gt; 1}.diff(:a =&gt; 1)
# =&gt; {}, first rule

{:a =&gt; 1}.diff(:a =&gt; 2)
# =&gt; {:a =&gt; 1}, second rule

{:a =&gt; 1}.diff(:b =&gt; 2)
# =&gt; {:a =&gt; 1, :b =&gt; 2}, third rule

{:a =&gt; 1, :b =&gt; 2, :c =&gt; 3}.diff(:b =&gt; 1, :c =&gt; 3, :d =&gt; 4)
# =&gt; {:a =&gt; 1, :b =&gt; 2, :d =&gt; 4}, all rules

{}.diff({})        # =&gt; {}
{:a =&gt; 1}.diff({}) # =&gt; {:a =&gt; 1}
{}.diff(:a =&gt; 1)   # =&gt; {:a =&gt; 1}
</pre>
</div>
</notextile>

<p>An important property of this diff hash is that you can retrieve the original hash by applying <tt>diff</tt> twice:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
hash.diff(hash2).diff(hash2) == hash
</pre>
</div>
</notextile>

<p>Diffing hashes may be useful for error messages related to expected option hashes for example.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/hash/diff.rb</tt>.</p></div>
<h4 id="working-with-keys">12.4 Working with Keys</h4>
<h5 id="except-and-except">12.4.1 <tt>except</tt> and <tt>except!</tt></h5>
<p>The method <tt>except</tt> returns a hash with the keys in the argument list removed, if present:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{:a =&gt; 1, :b =&gt; 2}.except(:a) # =&gt; {:b =&gt; 2}
</pre>
</div>
</notextile>

<p>If the receiver responds to <tt>convert_key</tt>, the method is called on each of the arguments. This allows <tt>except</tt> to play nice with hashes with indifferent access for instance:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{:a =&gt; 1}.with_indifferent_access.except(:a)  # =&gt; {}
{:a =&gt; 1}.with_indifferent_access.except(&quot;a&quot;) # =&gt; {}
</pre>
</div>
</notextile>

<p>The method <tt>except</tt> may come in handy for example when you want to protect some parameter that can&#8217;t be globally protected with <tt>attr_protected</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
params[:account] = params[:account].except(:plan_id) unless admin?
@account.update_attributes(params[:account])
</pre>
</div>
</notextile>

<p>There&#8217;s also the bang variant <tt>except!</tt> that removes keys in the very receiver.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/hash/except.rb</tt>.</p></div>
<h5 id="stringify_keys-and-stringify_keys">12.4.2 <tt>stringify_keys</tt> and <tt>stringify_keys!</tt></h5>
<p>The method <tt>stringify_keys</tt> returns a hash that has a stringified version of the keys in the receiver. It does so by sending <tt>to_s</tt> to them:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{nil =&gt; nil, 1 =&gt; 1, :a =&gt; :a}.stringify_keys
# =&gt; {&quot;&quot; =&gt; nil, &quot;a&quot; =&gt; :a, &quot;1&quot; =&gt; 1}
</pre>
</div>
</notextile>

<p>The result in case of collision is undefined:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{&quot;a&quot; =&gt; 1, :a =&gt; 2}.stringify_keys
# =&gt; {&quot;a&quot; =&gt; 2}, in my test, can't rely on this result though
</pre>
</div>
</notextile>

<p>This method may be useful for example to easily accept both symbols and strings as options. For instance <tt>ActionView::Helpers::FormHelper</tt> defines:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def to_check_box_tag(options = {}, checked_value = &quot;1&quot;, unchecked_value = &quot;0&quot;)
  options = options.stringify_keys
  options[&quot;type&quot;] = &quot;checkbox&quot;
  ...
end
</pre>
</div>
</notextile>

<p>The second line can safely access the &#8220;type&#8221; key, and let the user to pass either <tt>:type</tt> or &#8220;type&#8221;.</p>
<p>There&#8217;s also the bang variant <tt>stringify_keys!</tt> that stringifies keys in the very receiver.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/hash/keys.rb</tt>.</p></div>
<h5 id="symbolize_keys-and-symbolize_keys">12.4.3 <tt>symbolize_keys</tt> and <tt>symbolize_keys!</tt></h5>
<p>The method <tt>symbolize_keys</tt> returns a hash that has a symbolized version of the keys in the receiver, where possible. It does so by sending <tt>to_sym</tt> to them:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{nil =&gt; nil, 1 =&gt; 1, &quot;a&quot; =&gt; &quot;a&quot;}.symbolize_keys
# =&gt; {1 =&gt; 1, nil =&gt; nil, :a =&gt; &quot;a&quot;}
</pre>
</div>
</notextile>

<div class='warning'><p>Note in the previous example only one key was symbolized.</p></div>
<p>The result in case of collision is undefined:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{&quot;a&quot; =&gt; 1, :a =&gt; 2}.symbolize_keys
# =&gt; {:a =&gt; 2}, in my test, can't rely on this result though
</pre>
</div>
</notextile>

<p>This method may be useful for example to easily accept both symbols and strings as options. For instance <tt>ActionController::UrlRewriter</tt> defines</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def rewrite_path(options)
  options = options.symbolize_keys
  options.update(options[:params].symbolize_keys) if options[:params]
  ...
end
</pre>
</div>
</notextile>

<p>The second line can safely access the <tt>:params</tt> key, and let the user to pass either <tt>:params</tt> or &#8220;params&#8221;.</p>
<p>There&#8217;s also the bang variant <tt>symbolize_keys!</tt> that symbolizes keys in the very receiver.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/hash/keys.rb</tt>.</p></div>
<h5 id="to_options-and-to_options">12.4.4 <tt>to_options</tt> and <tt>to_options!</tt></h5>
<p>The methods <tt>to_options</tt> and <tt>to_options!</tt> are respectively aliases of <tt>symbolize_keys</tt> and <tt>symbolize_keys!</tt>.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/hash/keys.rb</tt>.</p></div>
<h5 id="assert_valid_keys">12.4.5 <tt>assert_valid_keys</tt></h5>
<p>The method <tt>assert_valid_keys</tt> receives an arbitrary number of arguments, and checks whether the receiver has any key outside that white list. If it does <tt>ArgumentError</tt> is raised.</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{:a =&gt; 1}.assert_valid_keys(:a)  # passes
{:a =&gt; 1}.assert_valid_keys(&quot;a&quot;) # ArgumentError
</pre>
</div>
</notextile>

<p>Active Record does not accept unknown options when building associations for example. It implements that control via <tt>assert_valid_keys</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
mattr_accessor :valid_keys_for_has_many_association
@@valid_keys_for_has_many_association = [
  :class_name, :table_name, :foreign_key, :primary_key,
  :dependent,
  :select, :conditions, :include, :order, :group, :having, :limit, :offset,
  :as, :through, :source, :source_type,
  :uniq,
  :finder_sql, :counter_sql,
  :before_add, :after_add, :before_remove, :after_remove,
  :extend, :readonly,
  :validate, :inverse_of
]

def create_has_many_reflection(association_id, options, &amp;extension)
  options.assert_valid_keys(valid_keys_for_has_many_association)
  ...
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/hash/keys.rb</tt>.</p></div>
<h4 id="slicing">12.5 Slicing</h4>
<p>Ruby has built-in support for taking slices out of strings and arrays. Active Support extends slicing to hashes:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{:a =&gt; 1, :b =&gt; 2, :c =&gt; 3}.slice(:a, :c)
# =&gt; {:c =&gt; 3, :a =&gt; 1}

{:a =&gt; 1, :b =&gt; 2, :c =&gt; 3}.slice(:b, :X)
# =&gt; {:b =&gt; 2} # non-existing keys are ignored
</pre>
</div>
</notextile>

<p>If the receiver responds to <tt>convert_key</tt> keys are normalized:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{:a =&gt; 1, :b =&gt; 2}.with_indifferent_access.slice(&quot;a&quot;)
# =&gt; {:a =&gt; 1}
</pre>
</div>
</notextile>

<div class='note'><p>Slicing may come in handy for sanitizing option hashes with a white list of keys.</p></div>
<p>There&#8217;s also <tt>slice!</tt> which in addition to perform a slice in place returns what&#8217;s removed:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
hash = {:a =&gt; 1, :b =&gt; 2}
rest = hash.slice!(:a) # =&gt; {:b =&gt; 2}
hash                   # =&gt; {:a =&gt; 1}
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/hash/slice.rb</tt>.</p></div>
<h4 id="indifferent-access">12.6 Indifferent Access</h4>
<p>The method <tt>with_indifferent_access</tt> returns an <tt>ActiveSupport::HashWithIndifferentAccess</tt> out of its receiver:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{:a =&gt; 1}.with_indifferent_access[&quot;a&quot;] # =&gt; 1
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/hash/indifferent_access.rb</tt>.</p></div>
<h3 id="extensions-to-regexp">13 Extensions to <tt>Regexp</tt></h3>
<h4 id="multiline">13.1 <tt>multiline?</tt></h4>
<p>The method <tt>multiline?</tt> says whether a regexp has the <tt>/m</tt> flag set, that is, whether the dot matches newlines.</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
%r{.}.multiline?  # =&gt; false
%r{.}m.multiline? # =&gt; true

Regexp.new('.').multiline?                    # =&gt; false
Regexp.new('.', Regexp::MULTILINE).multiline? # =&gt; true
</pre>
</div>
</notextile>

<p>Rails uses this method in a single place, also in the routing code. Multiline regexps are disallowed for route requirements and this flag eases enforcing that constraint.</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def assign_route_options(segments, defaults, requirements)
  ...
  if requirement.multiline?
    raise ArgumentError, &quot;Regexp multiline option not allowed in routing requirements: #{requirement.inspect}&quot;
  end
  ...
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/regexp.rb</tt>.</p></div>
<h3 id="extensions-to-range">14 Extensions to <tt>Range</tt></h3>
<h4 id="to_s">14.1 <tt>to_s</tt></h4>
<p>Active Support extends the method <tt>Range#to_s</tt> so that it understands an optional format argument. As of this writing the only supported non-default format is <tt>:db</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
(Date.today..Date.tomorrow).to_s
# =&gt; &quot;2009-10-25..2009-10-26&quot;

(Date.today..Date.tomorrow).to_s(:db)
# =&gt; &quot;BETWEEN '2009-10-25' AND '2009-10-26'&quot;
</pre>
</div>
</notextile>

<p>As the example depicts, the <tt>:db</tt> format generates a <tt>BETWEEN</tt> <span class="caps">SQL</span> clause. That is used by Active Record in its support for range values in conditions.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/range/conversions.rb</tt>.</p></div>
<h4 id="step">14.2 <tt>step</tt></h4>
<p>Active Support extends the method <tt>Range#step</tt> so that it can be invoked without a block:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
(1..10).step(2) # =&gt; [1, 3, 5, 7, 9]
</pre>
</div>
</notextile>

<p>As the example shows, in that case the method returns and array with the corresponding elements.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/range/blockless_step.rb</tt>.</p></div>
<h4 id="include">14.3 <tt>include?</tt></h4>
<p>The method <tt>Range#include?</tt> says whether some value falls between the ends of a given instance:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
(2..3).include?(Math::E) # =&gt; true
</pre>
</div>
</notextile>

<p>Active Support extends this method so that the argument may be another range in turn. In that case we test whether the ends of the argument range belong to the receiver themselves:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
(1..10).include?(3..7)  # =&gt; true
(1..10).include?(0..7)  # =&gt; false
(1..10).include?(3..11) # =&gt; false
(1...9).include?(3..9)  # =&gt; false
</pre>
</div>
</notextile>

<div class='warning'><p>The original <tt>Range#include?</tt> is still the one aliased to <tt>Range#===</tt>.</p></div>
<div class='note'><p>Defined in <tt>active_support/core_ext/range/include_range.rb</tt>.</p></div>
<h4 id="overlaps">14.4 <tt>overlaps?</tt></h4>
<p>The method <tt>Range#overlaps?</tt> says whether any two given ranges have non-void intersection:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
(1..10).overlaps?(7..11)  # =&gt; true
(1..10).overlaps?(0..7)   # =&gt; true
(1..10).overlaps?(11..27) # =&gt; false
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/range/overlaps.rb</tt>.</p></div>
<h3 id="extensions-to-proc">15 Extensions to <tt>Proc</tt></h3>
<h4 id="bind">15.1 <tt>bind</tt></h4>
<p>As you surely know Ruby has an <tt>UnboundMethod</tt> class whose instances are methods that belong to the limbo of methods without a self. The method <tt>Module#instance_method</tt> returns an unbound method for example:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Hash.instance_method(:delete) # =&gt; #&lt;UnboundMethod: Hash#delete&gt;
</pre>
</div>
</notextile>

<p>An unbound method is not callable as is, you need to bind it first to an object with <tt>bind</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
clear = Hash.instance_method(:clear)
clear.bind({:a =&gt; 1}).call # =&gt; {}
</pre>
</div>
</notextile>

<p>Active Support defines <tt>Proc#bind</tt> with an analogous purpose:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Proc.new { size }.bind([]).call # =&gt; 0
</pre>
</div>
</notextile>

<p>As you see that&#8217;s callable and bound to the argument, the return value is indeed a <tt>Method</tt>.</p>
<div class='note'><p>To do so <tt>Proc#bind</tt> actually creates a method under the hood. If you ever see a method with a weird name like <tt>__bind_1256598120_237302</tt> in a stack trace you know now where it comes from.</p></div>
<p>Action Pack uses this trick in <tt>rescue_from</tt> for example, which accepts the name of a method and also a proc as callbacks for a given rescued exception. It has to call them in either case, so a bound method is returned by <tt>handler_for_rescue</tt>, thus simplifying the code in the caller:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def handler_for_rescue(exception)
  _, rescuer = Array(rescue_handlers).reverse.detect do |klass_name, handler|
    ...
  end

  case rescuer
  when Symbol
    method(rescuer)
  when Proc
    rescuer.bind(self)
  end
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/proc.rb</tt>.</p></div>
<h3 id="extensions-to-date">16 Extensions to <tt>Date</tt></h3>
<h4 id="calculations">16.1 Calculations</h4>
<div class='note'><p>All the following methods are defined in <tt>active_support/core_ext/date/calculations.rb</tt>.</p></div>
<div class='info'><p>The following calculation methods have edge cases in October 1582, since days 5..14 just do not exist. This guide does not document their behavior around those days for brevity, but it is enough to say that they do what you would expect. That is, <tt>Date.new(1582, 10, 4).tomorrow</tt> returns <tt>Date.new(1582, 10, 15)</tt> and so on. Please check <tt>test/core_ext/date_ext_test.rb</tt> in the Active Support test suite for expected behavior.</p></div>
<h5 id="date-current">16.1.1 <tt>Date.current</tt></h5>
<p>Active Support defines <tt>Date.current</tt> to be today in the current time zone. That&#8217;s like <tt>Date.today</tt>, except that it honors the user time zone, if defined. It also defines <tt>Date.yesterday</tt> and <tt>Date.tomorrow</tt>, and the instance predicates <tt>past?</tt>, <tt>today?</tt>, and <tt>future?</tt>, all of them relative to <tt>Date.current</tt>.</p>
<h5 id="named-dates">16.1.2 Named dates</h5>
<h6 id="prev_year-next_year">16.1.2.1 <tt>prev_year</tt>, <tt>next_year</tt></h6>
<p>In Ruby 1.9 <tt>prev_year</tt> and <tt>next_year</tt> return a date with the same day/month in the last or next year:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d = Date.new(2010, 5, 8) # =&gt; Sat, 08 May 2010
d.prev_year              # =&gt; Fri, 08 May 2009
d.next_year              # =&gt; Sun, 08 May 2011
</pre>
</div>
</notextile>

<p>If date is the 29th of February of a leap year, you obtain the 28th:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d = Date.new(2000, 2, 29) # =&gt; Tue, 29 Feb 2000
d.prev_year               # =&gt; Sun, 28 Feb 1999
d.next_year               # =&gt; Wed, 28 Feb 2001
</pre>
</div>
</notextile>

<p>Active Support defines these methods as well for Ruby 1.8.</p>
<h6 id="prev_month-next_month">16.1.2.2 <tt>prev_month</tt>, <tt>next_month</tt></h6>
<p>In Ruby 1.9 <tt>prev_month</tt> and <tt>next_month</tt> return the date with the same day in the last or next month:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d = Date.new(2010, 5, 8) # =&gt; Sat, 08 May 2010
d.prev_month             # =&gt; Thu, 08 Apr 2010
d.next_month             # =&gt; Tue, 08 Jun 2010
</pre>
</div>
</notextile>

<p>If such a day does not exist, the last day of the corresponding month is returned:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Date.new(2000, 5, 31).prev_month # =&gt; Sun, 30 Apr 2000
Date.new(2000, 3, 31).prev_month # =&gt; Tue, 29 Feb 2000
Date.new(2000, 5, 31).next_month # =&gt; Fri, 30 Jun 2000
Date.new(2000, 1, 31).next_month # =&gt; Tue, 29 Feb 2000
</pre>
</div>
</notextile>

<p>Active Support defines these methods as well for Ruby 1.8.</p>
<h6 id="beginning_of_week-end_of_week">16.1.2.3 <tt>beginning_of_week</tt>, <tt>end_of_week</tt></h6>
<p>The methods <tt>beginning_of_week</tt> and <tt>end_of_week</tt> return the dates for the beginning and end of week, assuming weeks start on Monday:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d = Date.new(2010, 5, 8) # =&gt; Sat, 08 May 2010
d.beginning_of_week      # =&gt; Mon, 03 May 2010
d.end_of_week            # =&gt; Sun, 09 May 2010
</pre>
</div>
</notextile>

<p><tt>beginning_of_week</tt> is aliased to <tt>monday</tt> and <tt>at_beginning_of_week</tt>. <tt>end_of_week</tt> is aliased to <tt>sunday</tt> and <tt>at_end_of_week</tt>.</p>
<h6 id="prev_week-next_week">16.1.2.4 <tt>prev_week</tt>, <tt>next_week</tt></h6>
<p>The method <tt>next_week</tt> receives a symbol with a day name in English (in lowercase, default is <tt>:monday</tt>) and it returns the date corresponding to that day:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.next_week              # =&gt; Mon, 10 May 2010
d.next_week(:saturday)   # =&gt; Sat, 15 May 2010
</pre>
</div>
</notextile>

<p>The method <tt>prev_week</tt> is analogous:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d.prev_week              # =&gt; Mon, 26 Apr 2010
d.prev_week(:saturday)   # =&gt; Sat, 01 May 2010
d.prev_week(:friday)     # =&gt; Fri, 30 Apr 2010
</pre>
</div>
</notextile>

<h6 id="beginning_of_month-end_of_month">16.1.2.5 <tt>beginning_of_month</tt>, <tt>end_of_month</tt></h6>
<p>The methods <tt>beginning_of_month</tt> and <tt>end_of_month</tt> return the dates for the beginning and end of the month:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_month     # =&gt; Sat, 01 May 2010
d.end_of_month           # =&gt; Mon, 31 May 2010
</pre>
</div>
</notextile>

<p><tt>beginning_of_month</tt> is aliased to <tt>at_beginning_of_month</tt>, and <tt>end_of_month</tt> is aliased to <tt>at_end_of_month</tt>.</p>
<h6 id="beginning_of_quarter-end_of_quarter">16.1.2.6 <tt>beginning_of_quarter</tt>, <tt>end_of_quarter</tt></h6>
<p>The methods <tt>beginning_of_quarter</tt> and <tt>end_of_quarter</tt> return the dates for the beginning and end of the quarter of the receiver&#8217;s calendar year:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_quarter   # =&gt; Thu, 01 Apr 2010
d.end_of_quarter         # =&gt; Wed, 30 Jun 2010
</pre>
</div>
</notextile>

<p><tt>beginning_of_quarter</tt> is aliased to <tt>at_beginning_of_quarter</tt>, and <tt>end_of_quarter</tt> is aliased to <tt>at_end_of_quarter</tt>.</p>
<h6 id="beginning_of_year-end_of_year">16.1.2.7 <tt>beginning_of_year</tt>, <tt>end_of_year</tt></h6>
<p>The methods <tt>beginning_of_year</tt> and <tt>end_of_year</tt> return the dates for the beginning and end of the year:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_year      # =&gt; Fri, 01 Jan 2010
d.end_of_year            # =&gt; Fri, 31 Dec 2010
</pre>
</div>
</notextile>

<p><tt>beginning_of_year</tt> is aliased to <tt>at_beginning_of_year</tt>, and <tt>end_of_year</tt> is aliased to <tt>at_end_of_year</tt>.</p>
<h5 id="other-date-computations">16.1.3 Other Date Computations</h5>
<h6 id="years_ago-years_since">16.1.3.1 <tt>years_ago</tt>, <tt>years_since</tt></h6>
<p>The method <tt>years_ago</tt> receives a number of years and returns the same date those many years ago:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
date = Date.new(2010, 6, 7)
date.years_ago(10) # =&gt; Wed, 07 Jun 2000
</pre>
</div>
</notextile>

<p><tt>years_since</tt> moves forward in time:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
date = Date.new(2010, 6, 7)
date.years_since(10) # =&gt; Sun, 07 Jun 2020
</pre>
</div>
</notextile>

<p>If such a day does not exist, the last day of the corresponding month is returned:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Date.new(2012, 2, 29).years_ago(3)     # =&gt; Sat, 28 Feb 2009
Date.new(2012, 2, 29).years_since(3)   # =&gt; Sat, 28 Feb 2015
</pre>
</div>
</notextile>

<h6 id="months_ago-months_since">16.1.3.2 <tt>months_ago</tt>, <tt>months_since</tt></h6>
<p>The methods <tt>months_ago</tt> and <tt>months_since</tt> work analogously for months:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Date.new(2010, 4, 30).months_ago(2)   # =&gt; Sun, 28 Feb 2010
Date.new(2010, 4, 30).months_since(2) # =&gt; Wed, 30 Jun 2010
</pre>
</div>
</notextile>

<p>If such a day does not exist, the last day of the corresponding month is returned:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Date.new(2010, 4, 30).months_ago(2)    # =&gt; Sun, 28 Feb 2010
Date.new(2009, 12, 31).months_since(2) # =&gt; Sun, 28 Feb 2010
</pre>
</div>
</notextile>

<h6 id="weeks_ago">16.1.3.3 <tt>weeks_ago</tt></h6>
<p>The method <tt>weeks_ago</tt> works analogously for weeks:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Date.new(2010, 5, 24).weeks_ago(1)    # =&gt; Mon, 17 May 2010
Date.new(2010, 5, 24).weeks_ago(2)    # =&gt; Mon, 10 May 2010
</pre>
</div>
</notextile>

<h6 id="advance">16.1.3.4 <tt>advance</tt></h6>
<p>The most generic way to jump to other days is <tt>advance</tt>. This method receives a hash with keys <tt>:years</tt>, <tt>:months</tt>, <tt>:weeks</tt>, <tt>:days</tt>, and returns a date advanced as much as the present keys indicate:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
date = Date.new(2010, 6, 6)
date.advance(:years =&gt; 1, :weeks =&gt; 2)  # =&gt; Mon, 20 Jun 2011
date.advance(:months =&gt; 2, :days =&gt; -2) # =&gt; Wed, 04 Aug 2010
</pre>
</div>
</notextile>

<p>Note in the previous example that increments may be negative.</p>
<p>To perform the computation the method first increments years, then months, then weeks, and finally days. This order is important towards the end of months. Say for example we are at the end of February of 2010, and we want to move one month and one day forward.</p>
<p>The method <tt>advance</tt> advances first one month, and then one day, the result is:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Date.new(2010, 2, 28).advance(:months =&gt; 1, :days =&gt; 1)
# =&gt; Sun, 29 Mar 2010
</pre>
</div>
</notextile>

<p>While if it did it the other way around the result would be different:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Date.new(2010, 2, 28).advance(:days =&gt; 1).advance(:months =&gt; 1)
# =&gt; Thu, 01 Apr 2010
</pre>
</div>
</notextile>

<h5 id="changing-components">16.1.4 Changing Components</h5>
<p>The method <tt>change</tt> allows you to get a new date which is the same as the receiver except for the given year, month, or day:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Date.new(2010, 12, 23).change(:year =&gt; 2011, :month =&gt; 11)
# =&gt; Wed, 23 Nov 2011
</pre>
</div>
</notextile>

<p>This method is not tolerant to non-existing dates, if the change is invalid <tt>ArgumentError</tt> is raised:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Date.new(2010, 1, 31).change(:month =&gt; 2)
# =&gt; ArgumentError: invalid date
</pre>
</div>
</notextile>

<h5 id="date-durations">16.1.5 Durations</h5>
<p>Durations can be added and substracted to dates:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d = Date.current
# =&gt; Mon, 09 Aug 2010
d + 1.year
# =&gt; Tue, 09 Aug 2011
d - 3.hours
# =&gt; Sun, 08 Aug 2010 21:00:00 UTC +00:00
</pre>
</div>
</notextile>

<p>They translate to calls to <tt>since</tt> or <tt>advance</tt>. For example here we get the correct jump in the calendar reform:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Date.new(1582, 10, 4) + 1.day
# =&gt; Fri, 15 Oct 1582
</pre>
</div>
</notextile>

<h5 id="timestamps">16.1.6 Timestamps</h5>
<div class='info'><p>The following methods return a <tt>Time</tt> object if possible, otherwise a <tt>DateTime</tt>. If set, they honor the user time zone.</p></div>
<h6 id="beginning_of_day-end_of_day">16.1.6.1 <tt>beginning_of_day</tt>, <tt>end_of_day</tt></h6>
<p>The method <tt>beginning_of_day</tt> returns a timestamp at the beginning of the day (00:00:00):</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
date = Date.new(2010, 6, 7)
date.beginning_of_day # =&gt; Sun Jun 07 00:00:00 +0200 2010
</pre>
</div>
</notextile>

<p>The method <tt>end_of_day</tt> returns a timestamp at the end of the day (23:59:59):</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
date = Date.new(2010, 6, 7)
date.end_of_day # =&gt; Sun Jun 06 23:59:59 +0200 2010
</pre>
</div>
</notextile>

<p><tt>beginning_of_day</tt> is aliased to <tt>at_beginning_of_day</tt>, <tt>midnight</tt>, <tt>at_midnight</tt>.</p>
<h6 id="ago-since">16.1.6.2 <tt>ago</tt>, <tt>since</tt></h6>
<p>The method <tt>ago</tt> receives a number of seconds as argument and returns a timestamp those many seconds ago from midnight:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
date = Date.current # =&gt; Fri, 11 Jun 2010
date.ago(1)         # =&gt; Thu, 10 Jun 2010 23:59:59 EDT -04:00
</pre>
</div>
</notextile>

<p>Similarly, <tt>since</tt> moves forward:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
date = Date.current # =&gt; Fri, 11 Jun 2010
date.since(1)       # =&gt; Fri, 11 Jun 2010 00:00:01 EDT -04:00
</pre>
</div>
</notextile>

<h5 id="other-time-computations">16.1.7 Other Time Computations</h5>
<h4 id="date-conversions">16.2 Conversions</h4>
<h3 id="extensions-to-datetime">17 Extensions to <tt>DateTime</tt></h3>
<div class='warning'><p><tt>DateTime</tt> is not aware of <span class="caps">DST</span> rules and so some of these methods have edge cases when a <span class="caps">DST</span> change is going on. For example <tt>seconds_since_midnight</tt> might not return the real amount in such a day.</p></div>
<h4 id="calculations-datetime">17.1 Calculations</h4>
<div class='note'><p>All the following methods are defined in <tt>active_support/core_ext/date_time/calculations.rb</tt>.</p></div>
<p>The class <tt>DateTime</tt> is a subclass of <tt>Date</tt> so by loading <tt>active_support/core_ext/date/calculations.rb</tt> you inherit these methods and their aliases, except that they will always return datetimes:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
yesterday
tomorrow
beginning_of_week (monday, at_beginning_of_week)
end_on_week (at_end_of_week)
weeks_ago
prev_week
next_week
months_ago
months_since
beginning_of_month (at_beginning_of_month)
end_of_month (at_end_of_month)
prev_month
next_month
beginning_of_quarter (at_beginning_of_quarter)
end_of_quarter (at_end_of_quarter)
beginning_of_year (at_beginning_of_year)
end_of_year (at_end_of_year)
years_ago
years_since
prev_year
next_year
</pre>
</div>
</notextile>

<p>The following methods are reimplemented so you do <strong>not</strong> need to load <tt>active_support/core_ext/date/calculations.rb</tt> for these ones:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
beginning_of_day (midnight, at_midnight, at_beginning_of_day)
end_of_day
ago
since (in)
</pre>
</div>
</notextile>

<p>On the other hand, <tt>advance</tt> and <tt>change</tt> are also defined and support more options, they are documented below.</p>
<h5 id="named-datetimes">17.1.1 Named Datetimes</h5>
<h6 id="datetime-current">17.1.1.1 <tt>DateTime.current</tt></h6>
<p>Active Support defines <tt>DateTime.current</tt> to be like <tt>Time.now.to_datetime</tt>, except that it honors the user time zone, if defined. It also defines instance predicates <tt>past?</tt>, and <tt>future?</tt> relative to <tt>DateTime.current</tt>.</p>
<h5 id="other-extensions">17.1.2 Other Extensions</h5>
<h6 id="seconds_since_midnight">17.1.2.1 <tt>seconds_since_midnight</tt></h6>
<p>The method <tt>seconds_since_midnight</tt> returns the number of seconds since midnight:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
now = DateTime.current     # =&gt; Mon, 07 Jun 2010 20:26:36 +0000
now.seconds_since_midnight # =&gt; 73596
</pre>
</div>
</notextile>

<h6 id="utc-datetime">17.1.2.2 <tt>utc</tt></h6>
<p>The method <tt>utc</tt> gives you the same datetime in the receiver expressed in <span class="caps">UTC</span>.</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
now = DateTime.current # =&gt; Mon, 07 Jun 2010 19:27:52 -0400
now.utc                # =&gt; Mon, 07 Jun 2010 23:27:52 +0000
</pre>
</div>
</notextile>

<p>This method is also aliased as <tt>getutc</tt>.</p>
<h6 id="utc">17.1.2.3 <tt>utc?</tt></h6>
<p>The predicate <tt>utc?</tt> says whether the receiver has <span class="caps">UTC</span> as its time zone:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
now = DateTime.now # =&gt; Mon, 07 Jun 2010 19:30:47 -0400
now.utc?           # =&gt; false
now.utc.utc?       # =&gt; true
</pre>
</div>
</notextile>

<h6 id="datetime-advance">17.1.2.4 <tt>advance</tt></h6>
<p>The most generic way to jump to another datetime is <tt>advance</tt>. This method receives a hash with keys <tt>:years</tt>, <tt>:months</tt>, <tt>:weeks</tt>, <tt>:days</tt>, <tt>:hours</tt>, <tt>:minutes</tt>, and <tt>:seconds</tt>, and returns a datetime advanced as much as the present keys indicate.</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d = DateTime.current
# =&gt; Thu, 05 Aug 2010 11:33:31 +0000
d.advance(:years =&gt; 1, :months =&gt; 1, :days =&gt; 1, :hours =&gt; 1, :minutes =&gt; 1, :seconds =&gt; 1)
# =&gt; Tue, 06 Sep 2011 12:34:32 +0000
</pre>
</div>
</notextile>

<p>This method first computes the destination date passing <tt>:years</tt>, <tt>:months</tt>, <tt>:weeks</tt>, and <tt>:days</tt> to <tt>Date#advance</tt> documented above. After that, it adjusts the time calling <tt>since</tt> with the number of seconds to advance. This order is relevant, a different ordering would give different datetimes in some edge-cases. The example in <tt>Date#advance</tt> applies, and we can extend it to show order relevance related to the time bits.</p>
<p>If we first move the date bits (that have also a relative order of processing, as documented before), and then the time bits we get for example the following computation:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d = DateTime.new(2010, 2, 28, 23, 59, 59)
# =&gt; Sun, 28 Feb 2010 23:59:59 +0000
d.advance(:months =&gt; 1, :seconds =&gt; 1)
# =&gt; Mon, 29 Mar 2010 00:00:00 +0000
</pre>
</div>
</notextile>

<p>but if we computed them the other way around, the result would be different:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
d.advance(:seconds =&gt; 1).advance(:months =&gt; 1)
# =&gt; Thu, 01 Apr 2010 00:00:00 +0000
</pre>
</div>
</notextile>

<div class='warning'><p>Since <tt>DateTime</tt> is not <span class="caps">DST</span>-aware you can end up in a non-existing point in time with no warning or error telling you so.</p></div>
<h5 id="datetime-changing-components">17.1.3 Changing Components</h5>
<p>The method <tt>change</tt> allows you to get a new datetime which is the same as the receiver except for the given options, which may include <tt>:year</tt>, <tt>:month</tt>, <tt>:day</tt>, <tt>:hour</tt>, <tt>:min</tt>, <tt>:sec</tt>, <tt>:offset</tt>, <tt>:start</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
now = DateTime.current
# =&gt; Tue, 08 Jun 2010 01:56:22 +0000
now.change(:year =&gt; 2011, :offset =&gt; Rational(-6, 24))
# =&gt; Wed, 08 Jun 2011 01:56:22 -0600
</pre>
</div>
</notextile>

<p>If hours are zeroed, then minutes and seconds are too (unless they have given values):</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
now.change(:hour =&gt; 0)
# =&gt; Tue, 08 Jun 2010 00:00:00 +0000
</pre>
</div>
</notextile>

<p>Similarly, if minutes are zeroed, then seconds are too (unless it has given a value):</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
now.change(:min =&gt; 0)
# =&gt; Tue, 08 Jun 2010 01:00:00 +0000
</pre>
</div>
</notextile>

<p>This method is not tolerant to non-existing dates, if the change is invalid <tt>ArgumentError</tt> is raised:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
DateTime.current.change(:month =&gt; 2, :day =&gt; 30)
# =&gt; ArgumentError: invalid date
</pre>
</div>
</notextile>

<h5 id="datetime-durations">17.1.4 Durations</h5>
<p>Durations can be added and substracted to datetimes:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
now = DateTime.current
# =&gt; Mon, 09 Aug 2010 23:15:17 +0000
now + 1.year
# =&gt; Tue, 09 Aug 2011 23:15:17 +0000
now - 1.week
# =&gt; Mon, 02 Aug 2010 23:15:17 +0000
</pre>
</div>
</notextile>

<p>They translate to calls to <tt>since</tt> or <tt>advance</tt>. For example here we get the correct jump in the calendar reform:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
DateTime.new(1582, 10, 4, 23) + 1.hour
# =&gt; Fri, 15 Oct 1582 00:00:00 +0000
</pre>
</div>
</notextile>

<h3 id="extensions-to-time">18 Extensions to <tt>Time</tt></h3>
<h4 id="time-calculations">18.1 Calculations</h4>
<div class='note'><p>All the following methods are defined in <tt>active_support/core_ext/time/calculations.rb</tt>.</p></div>
<p>Active Support adds to <tt>Time</tt> many of the methods available for <tt>DateTime</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
past?
today?
future?
yesterday
tomorrow
seconds_since_midnight
change
advance
ago
since (in)
beginning_of_day (midnight, at_midnight, at_beginning_of_day)
end_of_day
beginning_of_week (monday, at_beginning_of_week)
end_on_week (at_end_of_week)
weeks_ago
prev_week
next_week
months_ago
months_since
beginning_of_month (at_beginning_of_month)
end_of_month (at_end_of_month)
prev_month
next_month
beginning_of_quarter (at_beginning_of_quarter)
end_of_quarter (at_end_of_quarter)
beginning_of_year (at_beginning_of_year)
end_of_year (at_end_of_year)
years_ago
years_since
prev_year
next_year
</pre>
</div>
</notextile>

<p>They are analogous. Please refer to their documentation above and take into account the following differences:</p>
<ul>
	<li><tt>change</tt> accepts an additional <tt>:usec</tt> option.</li>
	<li><tt>Time</tt> understands <span class="caps">DST</span>, so you get correct <span class="caps">DST</span> calculations as in</li>
</ul>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name=&quot;Madrid&quot;, ...&gt;

# In Barcelona, 2010/03/28 02:00 +0100 becomes 2010/03/28 03:00 +0200 due to DST.
t = Time.local_time(2010, 3, 28, 1, 59, 59)
# =&gt; Sun Mar 28 01:59:59 +0100 2010
t.advance(:seconds =&gt; 1)
# =&gt; Sun Mar 28 03:00:00 +0200 2010
</pre>
</div>
</notextile>

<ul>
	<li>If <tt>since</tt> or <tt>ago</tt> jump to a time that can&#8217;t be expressed with <tt>Time</tt> a <tt>DateTime</tt> object is returned instead.</li>
</ul>
<h4 id="time-constructors">18.2 Time Constructors</h4>
<p>Active Support defines <tt>Time.current</tt> to be <tt>Time.zone.now</tt> if there&#8217;s a user time zone defined, with fallback to <tt>Time.now</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name=&quot;Madrid&quot;, ...&gt;
Time.current
# =&gt; Fri, 06 Aug 2010 17:11:58 CEST +02:00
</pre>
</div>
</notextile>

<p>Analogously to <tt>DateTime</tt>, the predicates <tt>past?</tt>, and <tt>future?</tt> are relative to <tt>Time.current</tt>.</p>
<p>Use the <tt>local_time</tt> class method to create time objects honoring the user time zone:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name=&quot;Madrid&quot;, ...&gt;
Time.local_time(2010, 8, 15)
# =&gt; Sun Aug 15 00:00:00 +0200 2010
</pre>
</div>
</notextile>

<p>The <tt>utc_time</tt> class method returns a time in <span class="caps">UTC</span>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name=&quot;Madrid&quot;, ...&gt;
Time.utc_time(2010, 8, 15)
# =&gt; Sun Aug 15 00:00:00 UTC 2010
</pre>
</div>
</notextile>

<p>Both <tt>local_time</tt> and <tt>utc_time</tt> accept up to seven positional arguments: year, month, day, hour, min, sec, usec. Year is mandatory, month and day default to 1, and the rest default to 0.</p>
<p>If the time to be constructed lies beyond the range supported by <tt>Time</tt> in the runtime platform, usecs are discarded and a <tt>DateTime</tt> object is returned instead.</p>
<h5 id="time-durations">18.2.1 Durations</h5>
<p>Durations can be added and substracted to time objects:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now + 1.year
#  =&gt; Tue, 09 Aug 2011 23:21:11 UTC +00:00
now - 1.week
# =&gt; Mon, 02 Aug 2010 23:21:11 UTC +00:00
</pre>
</div>
</notextile>

<p>They translate to calls to <tt>since</tt> or <tt>advance</tt>. For example here we get the correct jump in the calendar reform:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Time.utc_time(1582, 10, 3) + 5.days
# =&gt; Mon Oct 18 00:00:00 UTC 1582
</pre>
</div>
</notextile>

<h3 id="extensions-to-process">19 Extensions to <tt>Process</tt></h3>
<h4 id="daemon">19.1 <tt>daemon</tt></h4>
<p>Ruby 1.9 provides <tt>Process.daemon</tt>, and Active Support defines it for previous versions. It accepts the same two arguments, whether it should chdir to the root directory (default, true), and whether it should inherit the standard file descriptors from the parent (default, false).</p>
<h3 id="extensions-to-file">20 Extensions to <tt>File</tt></h3>
<h4 id="atomic_write">20.1 <tt>atomic_write</tt></h4>
<p>With the class method <tt>File.atomic_write</tt> you can write to a file in a way that will prevent any reader from seeing half-written content.</p>
<p>The name of the file is passed as an argument, and the method yields a file handle opened for writing. Once the block is done <tt>atomic_write</tt> closes the file handle and completes its job.</p>
<p>For example, Action Pack uses this method to write asset cache files like <tt>all.css</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
File.atomic_write(joined_asset_path) do |cache|
  cache.write(join_asset_file_contents(asset_paths))
end
</pre>
</div>
</notextile>

<p>To accomplish this <tt>atomic_write</tt> creates a temporary file. That&#8217;s the file the code in the block actually writes to. On completion, the temporary file is renamed, which is an atomic operation on <span class="caps">POSIX</span> systems. If the target file exists <tt>atomic_write</tt> overwrites it and keeps owners and permissions.</p>
<div class='warning'><p>Note you can&#8217;t append with <tt>atomic_write</tt>.</p></div>
<p>The auxiliary file is written in a standard directory for temporary files, but you can pass a directory of your choice as second argument.</p>
<div class='note'><p>Defined in <tt>active_support/core_ext/file/atomic.rb</tt>.</p></div>
<h3 id="extensions-to-logger">21 Extensions to <tt>Logger</tt></h3>
<h4 id="around_-level">21.1 <tt>around_[level]</tt></h4>
<p>Takes two arguments, a <tt>before_message</tt> and <tt>after_message</tt> and calls the current level method on the <tt>Logger</tt> instance, passing in the <tt>before_message</tt>, then the specified message, then the <tt>after_message</tt>:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
logger = Logger.new(&quot;log/development.log&quot;)
  logger.around_info(&quot;before&quot;, &quot;after&quot;) { |logger| logger.info(&quot;during&quot;) }
</pre>
</div>
</notextile>

<h4 id="silence">21.2 <tt>silence</tt></h4>
<p>Silences every log level lesser to the specified one for the duration of the given block. Log level orders are: debug, info, error and fatal.</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
logger = Logger.new(&quot;log/development.log&quot;)
  logger.silence(Logger::INFO) do
    logger.debug(&quot;In space, no one can hear you scream.&quot;)
    logger.info(&quot;Scream all you want, small mailman!&quot;)
  end
</pre>
</div>
</notextile>

<h4 id="datetime_format">21.3 <tt>datetime_format=</tt></h4>
<p>Modifies the datetime format output by the formatter class associated with this logger. If the formatter class does not have a <tt>datetime_format</tt> method then this is ignored.</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Logger::FormatWithTime &lt; Logger::Formatter
    cattr_accessor(:datetime_format) { &quot;%Y%m%d%H%m%S&quot; }

    def self.call(severity, timestamp, progname, msg)
      &quot;#{timestamp.strftime(datetime_format)} -- #{String === msg ? msg : msg.inspect}\n&quot;
    end
  end

  logger = Logger.new(&quot;log/development.log&quot;)
  logger.formatter = Logger::FormatWithTime
  logger.info(&quot;&lt;- is the current time&quot;)
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/logger.rb</tt>.</p></div>
<h3 id="extensions-to-nameerror">22 Extensions to <tt>NameError</tt></h3>
<p>Active Support adds <tt>missing_name?</tt> to <tt>NameError</tt>, which tests whether the exception was raised because of the name passed as argument.</p>
<p>The name may be given as a symbol or string. A symbol is tested against the bare constant name, a string is against the fully-qualified constant name.</p>
<div class='info'><p>A symbol can represent a fully-qualified constant name as in <tt>:"ActiveRecord::Base"</tt>, so the behavior for symbols is defined for convenience, not because it has to be that way technically.</p></div>
<p>For example, when an action of <tt>PostsController</tt> is called Rails tries optimistically to use <tt>PostsHelper</tt>. It is OK that the helper module does not exist, so if an exception for that constant name is raised it should be silenced. But it could be the case that <tt>posts_helper.rb</tt> raises a <tt>NameError</tt> due to an actual unknown constant. That should be reraised. The method <tt>missing_name?</tt> provides a way to distinguish both cases:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def default_helper_module!
  module_name = name.sub(/Controller$/, '')
  module_path = module_name.underscore
  helper module_path
rescue MissingSourceFile =&gt; e
  raise e unless e.is_missing? &quot;#{module_path}_helper&quot;
rescue NameError =&gt; e
  raise e unless e.missing_name? &quot;#{module_name}Helper&quot;
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/name_error.rb</tt>.</p></div>
<h3 id="extensions-to-loaderror">23 Extensions to <tt>LoadError</tt></h3>
<p>Active Support adds <tt>is_missing?</tt> to <tt>LoadError</tt>, and also assigns that class to the constant <tt>MissingSourceFile</tt> for backwards compatibility.</p>
<p>Given a path name <tt>is_missing?</tt> tests whether the exception was raised due to that particular file (except perhaps for the &#8220;.rb&#8221; extension).</p>
<p>For example, when an action of <tt>PostsController</tt> is called Rails tries to load <tt>posts_helper.rb</tt>, but that file may not exist. That&#8217;s fine, the helper module is not mandatory so Rails silences a load error. But it could be the case that the helper module does exist and in turn requires another library that is missing. In that case Rails must reraise the exception. The method <tt>is_missing?</tt> provides a way to distinguish both cases:</p>
<notextile>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def default_helper_module!
  module_name = name.sub(/Controller$/, '')
  module_path = module_name.underscore
  helper module_path
rescue MissingSourceFile =&gt; e
  raise e unless e.is_missing? &quot;helpers/#{module_path}_helper&quot;
rescue NameError =&gt; e
  raise e unless e.missing_name? &quot;#{module_name}Helper&quot;
end
</pre>
</div>
</notextile>

<div class='note'><p>Defined in <tt>active_support/core_ext/load_error.rb</tt>.</p></div>
<h3 id="changelog">24 Changelog</h3>
<ul>
	<li>August 10, 2010: Starts to take shape, added to the index.</li>
	<li>April 18, 2009: Initial version by <a href="credits.html#fxn">Xavier Noria</a></li>
</ul>

        <h3>Feedback</h3>
        <p>
          You're encouraged to help in keeping the quality of this guide.
        </p>
        <p>
          If you see any typos or factual errors you are confident to
          patch, please clone <a href="https://github.com/lifo/docrails">docrails</a>
          and push the change yourself. That branch of Rails has public write access.
          Commits are still reviewed, but that happens after you've submitted your
          contribution. <a href="https://github.com/lifo/docrails">docrails</a> is
          cross-merged with master periodically.
        </p>
        <p>
          You may also find incomplete content, or stuff that is not up to date.
          Please do add any missing documentation for master. Check the
          <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a>
          for style and conventions.
        </p>
        <p>
          Issues may also be reported in <a href="https://github.com/lifo/docrails/issues">Github</a>.
        </p>
        <p>And last but not least, any kind of discussion regarding Ruby on Rails
          documentation is very welcome in the <a href="http://groups.google.com/group/rubyonrails-docs">rubyonrails-docs mailing list</a>.
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0</a> License</p>
      <p>"Rails", "Ruby on Rails", and the Rails logo are trademarks of David Heinemeier Hansson. All rights reserved.</p>
    </div>
  </div>

  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all()
  </script>
</body>
</html>
